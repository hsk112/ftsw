<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>会议签到</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link href="http://gd.wiseom.cn/supermap/iclient-mapboxgl.min.css" rel="stylesheet" />
		<link href="http://gd.wiseom.cn/supermap/mapbox-gl-enhance.css" rel="stylesheet" />


		<link href="../../../css/common.css" rel="stylesheet" />
		<link href="../../../css/mui.min.css" rel="stylesheet" />
		<link href="../../../css/mui.picker.min.css" rel="stylesheet" />
		<style>
			.home-item {
				position: fixed;
				width: 100%;
				z-index: 999;
				top: 0;
				left: 0;
				height: 200px;
				background: #FFFFFF
			}
			
			.home-item-title {
				font-size: 19px;
				width: 100%;
				height: 20px;
				text-align: left;
				padding: 25px 23px;
				color: #191515;
				font-weight: bold;
			}
			
			.home-item-title .span-bg {
				width: 78px;
				height: 12px;
				background: rgba(219, 232, 255, 1);
				margin-top: -10px;
			}
			
			
			.home-item-list {
				width: 100%;
				margin-top: 23px;
				height: 77px;
				/* height: 107px; */
			}
			
			.home-item-list .item {
				width: 25%;
				float: left;
				text-align: center;
				font-size: 13px;
				margin-bottom: 24px;
				/* border-bottom: 2px solid #EEEEEE; */
			
			}
			
			.home-item-list .item img {
				height: 40px;
				width: 40px;
				border-radius: 40px;
				margin: 0 auto;
				display: block;
				margin-bottom: 10px;
			}
			
			.mui-col-xs-6 {
				text-align: left;
			}
			.mui-table-view-cell.mui-collapse.mui-active .arrow_right{
				transform: rotate(90deg);
				margin-left: 5px;
			}
			.mui-control-content .mui-loading {
				margin-top: 50px;
			}
			.mui-slider{
				height: 100vh;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				border-bottom: 2px solid #337BFC;
				color: #337BFC;
			}
		   .mui-table-view-cell.mui-collapse.mui-active + .www .arrow_right {
		        transform: rotate(90deg);
		        margin-left: 5px;
		      }
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item {
				border-bottom: 0;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active{
				border-bottom: 0;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active +.titleleft{
				border-bottom: solid 2px #337BFC;
				display: inline-block;
			}

			.mui-segmented-control .mui-control-item {
				line-height: 43px;
			}
			.mui-scroll {
				background: #FFFFFF;
			}

			.task-ul {
				padding: 0;
			}

			.task-li {
				border-bottom: 5px solid #F4F4F4;
				height: 110px;
				padding: 0 20px;
			}

			.task-item {
				/* height: 50px; */
				line-height: 50px;
				/* padding: 0 5px; */
			}

			.task-item-btn {
				width: 50%;
				float: left;
				text-align: right;
				white-space: nowrap;
				padding: 0 0 0 5px;
			}

			.task-item-btn span {
				padding: 5px 15px;
				border: 1px solid #347CFC;
				color: #347CFC;
				border-radius: 21px;
				font-size: 12px;
			}

			.task-item-running {
				color: #FF5656;
				font-size: 13px;
				text-align: right;
				/* margin-right: 20px; */
			}

			.task-item-finished {
				color: #29CC85;
				font-size: 13px;
				text-align: right;
				/* margin-right: 20px; */
			}

			.task-item-ischange {
				color: #FF7800;
				font-size: 13px;
				text-align: right;
				/* margin-right: 20px; */
			}
			.task-item_status{
				position: absolute;
				top: 8px;
				right: 5px;
			}

			.bottom-item {
				background: #FFFFFF;
				position: absolute;
				width: 100%;
				bottom: 30px;
				z-index: 999;
				text-align: left;
				padding: 15px 0 20px 0;
				border-top-left-radius: 5%;
				border-top-right-radius: 5%;
			}
			.bottom-item-title {
				display: flex;
				align-items: center;
				position: relative;
				font-size:18px;
				color:rgba(22,21,21,1);
				font-weight: bold;
				margin-left: 15px;
			}

			.item1{
				position: absolute;
				top:4px;
				z-index: 10;
				right: 0px ;
				text-align: center;
				line-height: 24px;
				vertical-align: bottom;
				padding: 0 14px;
				border: 1px solid #337BFC;
				border-radius: 20px;
				height: 26px;
				font-size: 12px;
			}

			.item2{
				position: absolute;
				top:4px;
				z-index: 10;
				right: 0px ;
				text-align: center;
				line-height: 24px;
				vertical-align: bottom;
				padding: 0 14px;
				border: 1px solid #337BFC;
				border-radius: 20px;
				height: 26px;
				font-size: 12px;
			}

			.item3{
				position: absolute;
				top:4px;
				z-index: 10;
				right: 64px ;
				text-align: center;
				line-height: 24px;
				vertical-align: bottom;
				padding: 0 14px;
				/* border: 1px solid #337BFC; */
				border-radius: 20px;
				height: 26px;
				font-size: 12px;
			}

			.mui-navigate-left:after
			{
			    content: '\e472';
				left: 5px;
				bottom: 50px;
			}
			.object{
				display: flex;
				justify-content: space-between;
				margin: 8px 0;
			}
			.li-item{
				background-color:white;
			}
			.li-item-pull{
				background-color: #F4F4F4 !important;
			}
			.li-margin{
				margin-bottom: 13px;
				border-bottom: 1px solid #EDEDED;
				padding-bottom: 0px;
				font-size: 13px;
				padding-bottom: 10px;
			}
			.in-obj{
				font-weight: 400;
				color: #888888;
				margin-right: 7px;
			}
			.obj-title{
				color: #444444;
			}
			.bgc-white{
				background-color: white;
			}
			.bgc-grey{
				background-color: #F4F4F4;
			}
			.mui-navigate-r{
				background: #fff;
			}
			.icon-css{
				display: inline-block;
				vertical-align: top;
			}
			
			.task_title{
				display: inline-block;
				padding: 8px 0;
				color: #191515;
				font-size: 15px;
				font-weight: 500;
				width: 50%;
				word-break: break-all;
				white-space: pre-wrap;
			}
			.sec-line{
				color: #878787;
				font-size: 14px;
			}
			/* 	.arrow_right{
				transform: rotate(90deg);
			} */
			.ul-mar-bottom{
				margin-bottom: -18px;
			}
			.mui-table-view-cell>a:not(.mui-btn){
				margin: 0;
				padding:0;
			}
			.mui-table-view-cell.mui-active{
				background: #fff;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active.titleleft{
				border-bottom: solid 3px #337BFC;
				display: inline-block;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active.titleright{
				border-bottom: solid 3px #337BFC;
				display: inline-block;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active .lb{
				border-bottom: solid 3px #337BFC;
				display: inline-block;
				font-weight: bold;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active .dt{
				border-bottom: solid 3px #337BFC;
				display: inline-block;
				font-weight: bold;
			}
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item{
				    border-top: 7px solid #F4F4F4
			}
			.color888{
				color: #888888;
			}
			.ibh{
				display: inline-block;
				line-height: 28px;
			}
			.showMore{
				display: inline-block;
			}

			.mui-table-view-cell{
				padding: 0!important;
			}

			#select_ul span{
				padding: 0;
			}
			
			.mapboxgl-ctrl-bottom-left {
				bottom: -999px;
				left: 0;
			}

			#riverMap0,#riverMap1{
				width: 60px;
				height: 60px;
				position: absolute;
				left: 82%;
				top: 3%;
				z-index: 1;
			}

			#lakeMap1,#lakeMap0{
				width: 60px;
				height: 60px;
				position: absolute;
				left: 82%;
				top: 13%;
				z-index: 1;
			}

			.btn-outlined{
				border:1px solid #337BFC;
				color: #337BFC;
			}
			.mui-btn.mui-active:enabled{
				background: #337BFC;
			}

			#search_input{
				margin: 0;
				width: 90%;
				height: 32px;
				border-radius: 16px;
				border: none;
				padding-left: 35px;
			}

			#search{
				padding: 10px 0 ;
				background: #F4F4F4;
				position: relative;
			}
			
			#del_icon img{
				width: 14px;
				height: 14px;
				position: absolute;
				right: 9%;
				top: 35%;
			}

			#search_icon img{
				width: 14px;
				height: 14px;
				position: absolute;
				left: 9%;
				top: 35%;
			}

			#left_item{
				padding: 15px;
				background: #FFFFFF;
				position: fixed;
				bottom: 20%;
				left:19px;
				z-index: 100;
				border-radius: 5px;
				text-align: left;
			}
			#left_item ul li span{
				display: inline-block;
				width: 10px;
				height: 10px;
				border-radius: 50%;
				margin-right: 10px;
			}
			
			#midxedLi{
				background-color: #FFFFFF;
				padding: 0 20px;
			}
			
			.search-tip{
				display: inline-block;
				background-color: #FFFFFF;
				width: 100%;
				font-size: 14px;
				/* border-bottom: 5px solid #F4F4F4; */
			}
			
			.sign-in{
				display: inline-block;
				height: 26px;
				width: 60px;
				border: 1px solid #337BFB;
				color: #337BFB;
				font-size: 14px;
				line-height: 26px;
				/*border-radius: 13px;*/
				font-weight: 200;
			}
			
			.signed-in{
				display: inline-block;
				height: 26px;
				width: 60px;
				border: 1px solid transparent;
				color: #29CC85;
				font-size: 14px;
				line-height: 26px;
				/*border-radius: 13px;*/
				font-weight: 200;
			}
			
			.share{
				display: inline-block;
				height: 26px;
				width: 60px;
				border: 1px solid #337BFC;
				color: #337BFC;
				font-size: 14px;
				line-height: 26px;
				/*border-radius: 13px;*/
				font-weight: 200;
				margin-left: 5px;
			}
			
			#meetTitle{
				margin: 20px 20px 10px 20px;
				display: flex;
				align-items: center;
				
			}
			
			.meeting{
				font-size: 16px;
				font-weight: bold;
				width: 85%;
				overflow-x: scroll;
				overflow-y: hidden;
				white-space: nowrap;
			}
			
			.info{
				text-align: left;
				margin: 0 20px;
				font-size: 14px;
			}
			
			.info div,.info span{
				padding: 0;
				height: 30px;
				line-height: 30px;
				color: #888888;
			}
			
			.meetInfo{
				background-color: #FFFFFF;
				border-top: 5px solid #F4F4F4;
				padding-bottom: 10px;
			}
			
			/*#sign-wrapper{*/
				/*height: 160px;*/
				/*width: 100%;*/
				/*display: flex;*/
				/*align-items: center;*/
				/*background-color: #F4F4F4;*/
			/*}*/

			.bottom-item-btn .item {
				width: 100%;
				float: left;
				text-align: center;
				padding: 0 14px;

			}

			.bottom-item-btn {
				height: 100px;
				position: fixed;
				z-index: 999;
				width: 100%;
				background: #f2f2f2;
				bottom: 0px;
				padding-top: 30px;
				text-align: center;
			}
			.bottom-item-btn .item div {
				border: 1px solid #337BFB;
				border-radius: 20px;
				height: 40px;
				line-height: 40px;
				font-size: 16px;
				/*margin:0 auto;*/
			}

			.base-item{
				border-radius: 10px;
				background-color: white;
				width: 95%;display: inline-block;
				margin-bottom: 20px;
				padding: 10px 0px 0px 0px;
			}
			/*.add_meeting{*/
				/*width: 280px;*/
				/*height: 40px;*/
				/*border-radius: 20px;*/
				/*font-size: 16px;*/
				/*margin: 0 auto;*/
			/*}*/
		</style>
	</head>

	<body>
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<div class="bottom-item-btn" id="bottom-item-btn" >
			<div class="item" id="sign-wrapper">
				<div style="background: #337BFC;color: #fff" class="add_meeting">新增</div>
			</div>
		</div>
		<div class="home-item" style="display: none;" id="home-item">
			<div class="home-item-list" id="business_item">
				<div class="item" id="overview">
					<img src="../../../img/commom/overview-icon.png">
					<span>项目概览</span>
				</div>
				<div class="item" id="quality">
					<img src="../../../img/commom/quality-icon.png">
					<span>质量检查</span>
				</div>
				<div class="item" id="security">
					<img src="../../../img/commom/security-icon.png">
					<span>安全检查</span>
				</div>
				<div class="item" id="security">
					<img src="../../../img/commom/education-icon.png">
					<span>安全教育</span>
				</div>
				<div class="item" id="attendance">
					<img src="../../../img/commom/attendance-icon.png">
					<span>考勤统计</span>
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="mui-content" class="mui-page">
			<!--页面标题栏开始-->
			<!--页面标题栏结束-->
			<!--页面主内容区开始-->
			<div class="mui-page-content">
				<div class="mui-page-content">
					<div id="scroll-content" class="mui-scroll-wrapper" style="margin-bottom: 100px">
						<div class="mui-scroll">
							<div id="listNav" style="position: relative;">
								<div id="search">
									<div id="search_icon"><img src="../../../img/commom/search1@2x.png"></div>
									<div id="del_icon"><img src="../../../img/commom/del.png"></div>
									<input type="text" id="search_input" value="" placeholder="请输入会议名称" />
								</div>
								<div id="openFactor" style="height: 60px;line-height: 60px;text-align: left;">
									<div class="view-title search-tip">
										<img src="../../../img/commom/signin.png" style="width: 16px;height: 14px;line-height: 14px;vertical-align:middle;margin: 0 5px 0 20px" />
										<span id="itemLabel" style="line-height: 16px; ">会议列表</span>
										<span id="itemNum" style="color: #337BFC; margin-left: 10px; font-weight: bold;">0</span>
									</div>
								</div>
								<div style="height: 10px;background-color:#F4F4F4;">

								</div>
							</div>
							<div style="background-color:red;position: relative">
								<ul id="select_ul" style="background-color:#F4F4F4;">
									<div id="noDataTips" style='color: #888888;background:#F3F3F3;line-height:100px;width:100%; margin-top:5px; '>暂无数据！</div>
								</ul>
							</div>
							<!--<div id="qrcode">-->
								<!--&lt;!&ndash;二维码&ndash;&gt;-->
							<!--</div>-->

							<!--<div class="bottom-item-btn" id="bottom-item-btn">-->
								<!--<div id="sign-wrapper" class="item">-->
									<!--<button type="button" class="mui-btn mui-btn-primary add_meeting">新增</button>-->
								<!--</div>-->
							<!--</div>-->

						</div>

					</div>
				</div>
			</div>
			<!--页面主内容区结束-->
		</div>
		</div>
	</body>

	<script type="text/javascript" src="http://gd.wiseom.cn/supermap/mapbox-gl-enhance.js"></script>
	<script type="text/javascript" src="http://gd.wiseom.cn/supermap/iclient-mapboxgl.min.js"></script>

	<script src="../../../js/jquery.min.js"></script>
	<!--<script src="../../../js/util/jquery.qrcode.min.js"></script>-->
	<script src="../../../js/mui.min.js"></script>
	<script src="../../../js/mui.view.js"></script>
	<script src="../../../js/mui.locker.js"></script>
	<script src="../../../js/common.js"></script>
	<script src="../../../js/app.js"></script>
	<script src="../../../js/config.js"></script>
	<script src="../../../js/mixed.js"></script>
	<script src="../../../js/s4.js"></script>
	<script src="../../../js/smutils.js"></script>
	<script src="../../../js/byte&string.js"></script>
	<script src="../../../js/ajaxhook.min.js"></script>
	<script src="../../../js/mui.picker.min.js"></script>
	<script src="../../../js/position.js"></script>
	<!-- <script src="../../../js/vconsole.min.js"></script> -->
	<script src="../../../js/meeting/meeting.js"></script>
	<script src="../../../js/mui.pullrefresh.js"></script>
	<script src="../../../js/mui.init.pullrefresh.js"></script>
	<script src="../../../js/util/timeUtil.js"></script>

	<script>
        // // 二维码测试
        // jQuery(function(){
        //     jQuery('#qrcode').qrcode("http://192.168.3.51:3000/meetingSign?guid=20");
        // })
		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#mui-content'
		});

		// mui.back = function() {
		// 	var extras = {
		// 		target: "../meeting/index.html",
		// 		targetName: "会议签到"
		// 	}
		// 	app.openPage("../overview/projectList.html", {
		// 		titleNView: {
		// 			titleText: '项目概览',
		// 			autoBackButton: true,
		// 			closePage: true
		// 		},
		// 	}, extras);
		// }
		// var vConsole = new VConsole();
		mui.init({
			swipeBack: true,
			// pullRefresh: {
			// 	container: "#loadContainer", 
			// 	up: {
			// 		height: 1000,
			// 		auto: false,
			// 		contentrefresh: "正在加载...", 
			// 		contentnomore: '没有更多数据了', 
			// 		callback: function() {
			// 			alert("load")
			// 		}
			// 	}
			// }
		});

		var meetData = [];
		var loadFlag = false;
		//用于匹配改造的字典
		/**
		 * @param fn {Function}   实际要执行的函数
		 * @param delay {Number}  延迟时间，也就是阈值，单位是毫秒（ms）
		 * @return {Function}     返回一个“去弹跳”了的函数
		 */
		$("#noDataTips").on('tap', function() {
			$("#search_input").val("");
			getList(pageNo, pageSize)
		})

		mui("body").on("tap", ".mui-icon-clear", function() {
			$("#searchBox").html("")
		});


		var pageNo = '1';
		var pageSize = '20';
		var searchPageNo = '1';
		var searchPageSize = '20';
		var isShow = true;
		var mask = mui.createMask();
		var extras = {
			openNum: 0
		}

		//初始化单页的区域滚动
        var totalProjectName;//全局变量
        var totalPersonId;
		mui('.mui-scroll-wrapper').scroll();
		var pickerpxtop = null;
		var myProjectInfo = JSON.parse(localStorage.getItem("projectInfo"));
		mui.plusReady(function() {
            // console.log("id:"+plus.webview.currentWebview().id)
			var projectName = myProjectInfo.prjName;
			console.log("projectName:"+projectName)
            totalProjectName = myProjectInfo.prjName;
			var personId = app.userInfo().perId;
            totalPersonId = app.userInfo().perId;
			// 初始化数据列表
			getList(pageNo, pageSize, projectName, personId);
			var self = plus.webview.currentWebview();

			// 监听Refresh
            window.addEventListener("Refresh", function(env) {
                // console.log("监听")
                getList(pageNo, pageSize, projectName, personId);
            });

			self.setStyle({
				titleNView: {
					backgroundImage: "../../../img/bgTop.png",
					backgroundRepeat: 'no-repeat',
					buttons: [{
						float: 'right',
						width: '70',
						fontSize: '17',
						text: '',
						onclick: function() {
							if (isShow) {
								isShow = false;
								$("#home-item").show();
								mask.show()
							} else {
								isShow = true;
								$('#home-item').hide();
								mask.close();
							}
						}
					}],
				}
			});

            var originalHeight = document.documentElement.clientHeight || document.body.clientHeight;
            window.onresize = function() {
                var resizeHeight = document.documentElement.clientHeight || document.body.clientHeight;
                //软键盘弹起与隐藏  都会引起窗口的高度发生变化
                if (resizeHeight * 1 < originalHeight * 1) { //resizeHeight<originalHeight证明窗口被挤压了
                    // plus.webview.currentWebview().setStyle({
                    // 	height: originalHeight + 75
                    // });
                    $("#scroll-content").css("margin","0")
                    $("#bottom-item-btn").hide()
                }else{
                    $("#scroll-content").css("margin-bottom","100px")
                    $("#bottom-item-btn").show()
                }
            }
		});

		// getList(pageNo, pageSize, "525测试项目", "a2205aec789884b849e61fd6414dc490");
		// methods
		function signIn(index) {
			let extras = {
				Data: listData[index]
			};
			app.openPage("./internal_sign.html", {
				titleNView: {
					titleText: '会议签到',
					autoBackButton: true,
					closePage: true,
				},
			}, extras);
		}

		function share(index) {
            var end = Date.parse(listData[index].endTime);
            var now = Date.parse(new Date());
            if(now > end){
                app.toast("会议已结束，无法分享")
                return;
            }
			let extras = {
				Data: listData[index]
			};
			app.openPage("./share.html", {
				titleNView: {
					titleText: '会议签到',
					autoBackButton: true,
					closePage: true,
				},
			}, extras);
		}

		var initDestoryData = function(data, callback) {
			for (let key in data) {
				if (data[key] == '' || data[key] == null) {
					data[key] = '无'
				}
			}
			callback(data);
		}
		
		// 用于传递给签到页面的数据
		var listData = [];
	
		
		// 获取列表数据
		function getList(pageNo, pageSize, projectName, personId) {
			$("#del_icon").hide();
			getMeetingList(pageNo, pageSize, projectName, personId, function(data) {
				var str = ""
				var str1 = "";
				var str2 = "";
				var str3 = "";
				var areaHtml = ``
				listData = data.result.records;
				if(data.result.records.length !== 0){
					for (let i = 0; i < data.result.records.length; i++) {
						initDestoryData(data.result.records[i], function(Data) {
							console.log(JSON.stringify(Data))
							let startTime = Data.startTime.split(' ');
							let endTime = Data.endTime.split(' ');
							let holdDate = Data.conferenceTime.split(' ')
							let continueTime = holdDate[0] + ' ' + startTime[1] + '-' + endTime[1]
							startTime = Data.startTime.substring(0,16)
							endTime = Data.endTime.substring(0,16)
							var time = startTime + "-" + endTime.substring(endTime.length-5)
                            var dur = DateDifference(startTime,endTime)//时间间隔
							let conferenceTime = Data.conferenceTime.substring(0,16)

							// console.log("格式转换："+startTime+","+endTime);

							// 会议人数
							let memberNum = Data.participant == '无' ? '0' : Data.participant.split(',').length;
							
							// console.log("会议列表:"+JSON.stringify(Data))
							str +=
								`
								<li>
									<div style="position: relative;">
										<div style="width: 42%; display: inline-block;z-index:999; position: absolute;top: 20px; right: 20px;">
											
								`;
							// if(Data.attendanceStatus == '0'){
							if(Data.existFlag === true){
								str +=`<div class="signed-in">已签到</div>`
							}else{
								str +=`<div class="sign-in" onclick='signIn(${i})'>签到</div>`
							}

							str += `<div class="share" onclick='share(${i})'>分享</div>
									</div>
									<div class="meetInfo mui-table-view-cell mui-collapse">
										<a href="#">
											<div id="meetTitle" class="mui-row">
												<div style="width: 56%; display: flex; text-align: left;">
													<span class="icon-css" style="width: 8%;">
														<img src="../../../img/commom/xl.png" class="arrow_right" style="width: 7px;" alt="">
													</span>
													<div class="meeting">
														<div style="width: 500px;">${Data.conferenceTitle}</div>
													</div>
												</div>
											</div>
											<div class="info">
												<span style="display: inline-block; width: 33%;">ID: ${Data.projectNo}</span>
												<span style="display: inline-block; width: 33%;">主持人: ${Data.hostFullname}</span>
												<span style="display: inline-block; width: 33%;">会议人数: ${memberNum}</span>
											</div>
							
											<div class="info" style="margin-bottom: 10px;">
												<div>会议时间：`+conferenceTime+`</div>
											</div>
										</a>
										<div class="mui-collapse-content" style="margin-top: 0; padding-bottom: 20px;">
											<div class="info" style="border-top: 1px solid #EDEDED;">
												<div class="mui-row" style="margin-top: 20px;">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议开始时间：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8">
														`+startTime+`
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议结束时间：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8">
														`+endTime+`
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议时长：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8">
														<div style="width: 100%;white-space: nowrap; overflow-x: scroll;">
															`+dur+`
														</div>
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议地址：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8" >
														 <div style="width: 100%;white-space: nowrap; overflow-x: scroll;">
															${Data.conferenceAddress}
														 </div>
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														填写人：
													</div>
													<div class="mui-col-sm-6 mui-col-xs-6">
														${Data.inputFullname}
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														单位名称：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8" >
														 <div style="width: 100%;white-space: nowrap; overflow-x: scroll;">
															${Data.inputDepartmentFullname}
														 </div>
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														联系电话：
													</div>
													<div class="mui-col-sm-6 mui-col-xs-6">
														${Data.inputPhone}
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</li>
							`

							areaHtml += `
								<div class="base-item" >
									<div style="margin: 10px 0px 10px 5px;border-bottom: 1px solid #EDEDED;">
										<div style="padding-bottom: 10px;width: 65%;display: inline-block;text-align: left;">
											<span style="font-size: 13pt;line-height: 40px">
												${Data.conferenceTitle}
											</span>
										</div>
										<div style="width: 35%;display: inline">
											<!--<button class="dang-an">-->
												<!--历史档案-->
											<!--</button>-->
											<div class="sign-in dang-an" onclick='signIn(${i})'>签到</div>
										</div>
									</div>

									<div onclick='share(${i})' style="padding-top:10px;margin-left: 20px;padding-bottom: 15px;border-bottom: 1px solid #EDEDED;">
										<div style="text-align: left;">
											<div style="text-align: left;display: inline-block;width: 65%;padding-bottom: 5px">
											<span style="color: #B2B2B2">
												发起人:
											</span>
											<span>
												${Data.hostFullname}
											</span>
										</div>

											<div style="width: 35%;display: inline;">
											<span style="color: #B2B2B2;">
												会议人数:
											</span>
												<span>
													${memberNum}
												</span>
											</div>
										</div>

										<div style="text-align: left;margin-top:5px">
											<div style="display: inline-block;width: 100%">
											<span style="color: #B2B2B2;">
												时间:
											</span>
												<span>
													`+time+`
												</span>
											</div>
										</div>

										<div style="text-align: left;margin-top: 10px">
											<div style="display: inline-block;width: 100%">
											<span style="color: #B2B2B2;">
												地址:
											</span>
												<span>
													${Data.conferenceAddress}
												</span>
											</div>
										</div>
									</div>
								</div>`
						})
					}
					// str = str1 + str2 + str3
					$('#select_ul').html(areaHtml);
					$('#itemNum').text(data.result.records.length)
				}else{
					$('#noDataTips').show();
				}
			})
		}

		var listView = function(data) {
			if (data.result.total == 0) {
				// $('#select_ul').emp	ty();
				$("#noDataTips").show();
				$('#itemNum').text("0")
			} else {
				$('#noDataTips').hide();
				meetData = data.result.records;
				let str2 = '';
				let listLength = meetData.length;
				let state = '';
				
				for (let i = 0; i < meetData.length; i++) {
					initDestoryData(meetData[i], function(Data) {
						num = Number(Data.reformState)
						state = stateColor[num - 1].status;
						textColor = stateColor[num - 1].color;

						str2 += ``
					})
				}

			}
		}

		// JQ
		// 项目概览
		$('.add_meeting').on('tap', function() {
			app.openPage("./add_meeting.html", {
				titleNView: {
					titleText: '新增会议',
					autoBackButton: true,
					closePage: true,
				},
			});
		})

		$("#overview").on('tap', function() {
			app.openPage("../overview/overviewOne.html", {
				titleNView: {
					titleText: '项目概览',
					autoBackButton: true,
					closePage: true,
				},
			});
		});

		// 质量检查
		$("#quality").on('tap', function() {
			app.openPage("../quality/index.html", {
				titleNView: {
					titleText: '质量检查',
					autoBackButton: true,
					closePage: true,
				},
			});
		});

		// 安全检查
		$("#security").on('tap', function() {
			app.openPage("../security/index.html", {
				titleNView: {
					titleText: '安全检查',
					autoBackButton: true,
					closePage: true,
				},
			});
		});

		// 安全教育
		$("#security").on('tap', function() {
			app.openPage("../education/index.html", {
				titleNView: {
					titleText: '安全教育',
					autoBackButton: true,
					closePage: true,
				},
			});
		});

		// 考勤统计
		$("#attendance").on('tap', function() {
			app.openPage("../attendance/month.html", {
				titleNView: {
					titleText: '考勤统计',
					autoBackButton: true,
					closePage: true,
				},
			});
		});

        $('#search_input').on('tap',function(){
            $("#select_ul").css("z-index","1000")
            $('#select_ul').css("bottom","0px");
		})
        // debounce节流
		$('#search_input').on('input', debounce((e) => {
		    //监听输入框
            if ($("#search_input").val() != '') {
				$("#del_icon").show();//删除按钮显示
            } else {
				$("#del_icon").hide();//删除按钮隐藏
            }
            serchMeeting();
        }, 600))

		var serchMeeting = function() {
			if ($("#search_input").val() != '') {
				$("#del_icon").show();
				let conferenceTitle = $("#search_input").val()
                var param = {
                    conferenceTitle: conferenceTitle,
                    pageNo: 1,
                    pageSize: 999,
                }
                meetSearchByName(param, function(Data){
                    // console.log("会议查询结果："+JSON.stringify(data))
					if(Data.success == true && Data.result.records.length>0){
					    //有数据
						var str='';
						for(let i = 0; i < Data.result.records.length; i++){
                            let startTime = Data.result.records[i].startTime.split(' ');
                            let endTime = Data.result.records[i].endTime.split(' ');
                            let holdDate = Data.result.records[i].conferenceTime.split(' ')
                            let continueTime = holdDate[0] + ' ' + startTime[1] + '-' + endTime[1]

                            // 会议人数
                            let memberNum = (Data.result.records[i].participant == '无' || Data.result.records[i].participant == null) ? '0' : Data.result.records[i].participant.split(',').length;

                            str +=
                                `
								<li>
									<div style="position: relative;">
										<div style="width: 42%; display: inline-block;z-index:999; position: absolute;top: 20px; right: 20px;">

								`;
                            // if(Data.attendanceStatus == '0'){
                            if(Data.result.records[i].existFlag === true){
                                str +=`<div class="signed-in">已签到</div>`
                            }else{
                                str +=`<div class="sign-in" onclick='signIn(${i})'>签到</div>`
                            }

                            str += `<div class="share" onclick='share(${i},${Data.result.records[i].endTime})'>分享</div>
									</div>
									<div class="meetInfo mui-table-view-cell mui-collapse">
										<a href="#">
											<div id="meetTitle" class="mui-row">
												<div style="width: 56%; display: flex; text-align: left;">
													<span class="icon-css" style="width: 8%;">
														<img src="../../../img/commom/xl.png" class="arrow_right" style="width: 7px;" alt="">
													</span>
													<div class="meeting">
														<div style="width: 500px;">${Data.result.records[i].conferenceTitle}</div>
													</div>
												</div>
											</div>
											<div class="info">
												<span style="display: inline-block; width: 33%;">ID: ${Data.result.records[i].projectNo}</span>
												<span style="display: inline-block; width: 33%;">主持人: ${Data.result.records[i].hostFullname}</span>
												<span style="display: inline-block; width: 33%;">会议人数: ${memberNum}</span>
											</div>

											<div class="info" style="margin-bottom: 10px;">
												<div>会议时间：${Data.result.records[i].conferenceTime}</div>
											</div>
										</a>
										<div class="mui-collapse-content" style="margin-top: 0; padding-bottom: 20px;">
											<div class="info" style="border-top: 1px solid #EDEDED;">
												<div class="mui-row" style="margin-top: 20px;">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议开始时间：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8">
														${Data.result.records[i].startTime}
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议结束时间：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8">
														${Data.result.records[i].endTime}
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议时长：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8">
														<div style="width: 100%;white-space: nowrap; overflow-x: scroll;">
															${continueTime}
														</div>
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														会议地址：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8" >
														 <div style="width: 100%;white-space: nowrap; overflow-x: scroll;">
															${Data.result.records[i].conferenceAddress}
														 </div>
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														填写人：
													</div>
													<div class="mui-col-sm-6 mui-col-xs-6">
														${Data.result.records[i].inputFullname}
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														单位名称：
													</div>
													<div class="mui-col-sm-8 mui-col-xs-8" >
														 <div style="width: 100%;white-space: nowrap; overflow-x: scroll;">
															${Data.result.records[i].inputDepartmentFullname}
														 </div>
													</div>
												</div>
												<div class="mui-row">
													<div class="mui-col-sm-4 mui-col-xs-4">
														联系电话：
													</div>
													<div class="mui-col-sm-6 mui-col-xs-6">
														${Data.result.records[i].inputPhone}
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</li>
							`
						}
                        $('#select_ul').html(str);
                        $('#itemNum').text(Data.result.records.length)
					}else{
					    // 查无数据
						console.log('条件查询无数据')
						$('#select_ul').html(`<div id="noDataTips" style='color: #888888;background:#F3F3F3;line-height:100px;width:100%; margin-top:5px; '>暂无数据！</div>`)
					}
                    // listView(data);
				})

			} else {
			    console.log("查询条件为空")
				$("#del_icon").hide();
                getList(pageNo, pageSize, totalProjectName, totalPersonId);//数据清空时，再搜索一次
			}
		}

		$("#del_icon").on('tap', function() {
			$('#search_input').val('');
			$("#del_icon").hide();
            getList(pageNo, pageSize, totalProjectName, totalPersonId);//搜索条件关闭时，再搜索一次
		})

		//关闭遮罩层
		$(document).on("click", ".mui-backdrop", function() {
			isShow = true;
			$('#home-item').hide();
			mask.close();
		})

		window.addEventListener('backInspection', function(e) { //执行刷新
			// location.reload();
			getList(pageNo, pageSize);
			getMapList();
			mui('#scroll1').scroll().scrollTo(0, 0, 0);
			mui('#contentList').scroll().scrollTo(0, 0, 0);
		});
	</script>

</html>
