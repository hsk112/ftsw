<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>项目概览</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../../../css/mui.min.css" rel="stylesheet" />
		<link href="../../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../../css/mui.poppicker.css" rel="stylesheet" />
		<link href="../../../css/common.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../../css/overview.css"/>
		<style type="text/css">
			.arrow-down {
					border-left: 1px solid #337BFC;
					border-bottom: 1px solid #337BFC;
					height: 10px;
					width: 10px;
					color:#337BFC;
					transform: translate(2px, -2px) rotate(-45deg);
					-webkit-transform: translate(2px, -2px) rotate(-45deg);
					border-right: 1px solid transparent;
					border-top: 1px solid transparent;
					display: inline-block;
					-moz-transform: translate(2px, -2px) rotate(-45deg);
					-ms-transform: translate(2px, -2px) rotate(-45deg);
					-o-transform: translate(2px, -2px) rotate(-45deg);
			}
		</style>
	</head>

	<body>
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<!-- <div class="mui-navbar">
					</div> -->
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="mui-content" class="mui-page">
			<!--底部导航栏-->
			<!--页面主内容区开始-->
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="scroll-li">
							<div class="bar-title home-item">
								资金状况
								<div id="select-item" class="select-item">
									<span id="item_text">全网改造工程</span>
									<span id="down" class="mui-icon mui-icon-arrowdown" style="vertical-align: middle;"></span>
									<span id="up" class="mui-icon mui-icon-arrowup" style="vertical-align: middle;display: none;"></span>
								</div>
								<!-- <div id="select-item" class="select-item">生态环保工程<span class='arrow-down'></span></div>
								<div id="select-item" class="select-item">河道泵站工程<span class='arrow-down'></span></div> -->
							</div> 
							<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
							<div id="main" style="width: 100%;height:350px;"></div>

							<div class="bar-title home-item">
								项目进度
							</div>
							<div id="main2" style="width: 100%;height:400px;"></div>

							<div class="bar-title home-item">
								安全情况
							</div>
							<div id="main3" style="width: 100%;height:350px;"></div>

							<div class="bar-title home-item">
								数量情况
							</div>
							<div id="main4" style="width: 100%;height:350px;"></div>

						</div>
					</div>
				</div>
			</div>
			<!--页面主内容区结束-->
		</div>

	</body>
</html>
<script src="../../../js/mui.min.js"></script>
<script src="../../../js/echarts.min.js"></script>
<script src="../../../js/mui.view.js"></script>
<script src="../../../js/mui.locker.js"></script>
<script src="../../../js/mui.picker.min.js"></script>
<script src="../../../js/mui.picker.js"></script>
<script src="../../../js/mui.poppicker.js"></script>

<script src="../../../js/app.js"></script>
<script src="../../../js/config.js"></script>
<script src="../../../js/overview.js"></script>
<script src="../../../js/update.js"></script>
<script src="../../../js/helper.js"></script>
<script src="../../../js/jquery.min.js"></script>
<script src="../../../js/common.js"></script>
<script src="../../../js/s4.js"></script>
<script src="../../../js/smutils.js"></script>
<script src="../../../js/byte&string.js"></script>
<script src="../../../js/ajaxhook.min.js"></script>
<script src="../../../js/vconsole.min.js"></script>
<script src="../../../js/allprj/allprj.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	// var vConsole = new VConsole();
	let myProjectInfo = JSON.parse(localStorage.getItem("projectInfo"));
	let prjData = {
		prjName:myProjectInfo.prjName,
		projectId:myProjectInfo.prjId
	};
	let year = new Date().getFullYear();
	console.log(myProjectInfo);
	mui.init();
	mui.plusReady(function() {
		// getPrjInfoList(year,(res)=>{
		// 	console.log(res)
		// })
	})
	//初始化单页view 
	var viewApi = mui('#app').view({
		defaultPage: '#mui-content'
	});
	//初始化单页的区域滚动
	//注意：列表的自动滑动属性会影响滑动效果，必须注释掉
	mui('.mui-scroll-wrapper').scroll();
	
	var selectItems=[
		{text:"全网改造工程",value:1},
		{text:"生态环保工程",value:2},
		{text:"河道治理工程",value:3}
	]

	var moneyArr = [{
			value: 100,
			name: '生态提升/改造/政治工程'
		},
		{
			value: 31,
			name: '正本清源项目'
		},
		{
			value: 25,
			name: '优质饮用水项目'
		},
		{
			value: 19,
			name: '路面塌陷项目'
		},
		{
			value: 45,
			name: '生态建设项目'
		},
		{
			value: 52,
			name: '河道治理项目'
		},
		{
			value: 20,
			name: '水质提升工程'
		},
		{
			value: 30,
			name: '生态建设项目'
		},
		{
			value: 40,
			name: '内涝治理项目'
		},
	];
	var list={
		titles:['前期设计', '报批报建', '招标工作', '合同签订', '施工', '竣工验收', '结算送审'],
		data1:[320, 302, 301, 334, 390, 330, 320],
		data2:[120, 132, 101, 134, 90, 230, 210],
		data3:[220, 182, 191, 234, 290, 330, 310],
		data4:[350, 312, 401, 554, 200, 330, 410]
	}

	//初始化单页view
	var viewApi = mui('#app').view({
		defaultPage: '#mui-content'
	});
	var picker = new mui.PopPicker();
	mui.plusReady(function() {
		var legendData = [];
		var total = 0;
		moneyArr.forEach(item => {
			total += item.value;
			legendData.push(item.name);
		})
		//资金状况
		var myChart = echarts.init(document.getElementById('main'));
		var myChart3 = echarts.init(document.getElementById('main3'));
		var myChart4 = echarts.init(document.getElementById('main4'));
		// 指定图表的配置项和数据
		var option1 = {
			color: ['#337BFC', '#43DE87', '#FFBB00', '#FF584C', '#9665E2', '#47CBCA', '#7DD936', '#655CE6', '#E63984'],
			title: {
				show: true,
				text: total, //主标题
				subtext: '总资金(万)', //副标题：企业数量值，此处用标题方式来显示
				left: '49%',
				align: 'center',
				textAlign: 'center',
				top: '26%',
				z: 0,
				zlevel: 100,
				textStyle: {
					//设置副标题的样式
					width: 200,
					color: '#000',
					fontSize: 25,
					fontWeight: 'bold',
				},
				subtextStyle: {
					//设置主标题的 样式
					color: '#8C8C8C',
					fontSize: 16,
				},
			},
			tooltip: {
				// trigger: 'item',
				// formatter: '{b}:{d}%',
				show:false,
			},
			legend: {
				orient: 'horizontal',
				// top: '60%',
				bottom:15,
				width:'90%',
				left: 'center',
				borderRadius:10,
				itemWidth:10,
				itemHeight:10,
				icon: 'circle',
				itemGap: 12, // 设置间距
				data: legendData,
				formatter: function(name) {
					for (let item of moneyArr) {
						if (name == item.name) {
							return ['{name|' + name + '} {num|' + item.value + '}万'].join(''); //name + ' ' + total;
						}
					}
				},
				textStyle: {
					rich: {
						name: {
							fontSize: 12,
							fontWeight: 400,
							color: '#8C8C8C',
						},
						num: {
							fontSize: 12,
							fontWeight: 400,
							color: '#282828',
							padding: [0, 0, 0, 5],
						},
					},
					fontSize: 12,
					fontWeight: 400,
					color: '#8C8C8C',
				},
			},
			series: [{
					name: '',
					type: 'pie',
					selectedMode: 'single',
					label: {
						position: 'inner',
					},
					labelLine: {
						show: false,
					},
				},
				{
					name: '',
					type: 'pie',
					radius: ['30%', '40%'],
					center: ['50%', '35%'],
					labelLine:{
						show:true,
						lineStyle:{
							color:'#337BFC'
						}
					},
					label: {
						normal: {
							show: false
						},
						emphasis: {
							show: true,
							formatter: (params) => {
								return `${params.name} \n ${((params.value/total)*100).toFixed(2)}% `;
							},
							color :function(params){
								return '#1089E7'
							},
							// borderRadius: 4,
							rich: {
								name: {
									fontSize: 12,
									fontWeight: 400,
									color: '#337BFC',
									lineHeight: 20,
								}
							},
						}
					},
					data: moneyArr,
				},
			],
		};
		// 使用刚指定的配置项和数据显示图表。
		myChart.setOption(option1);
		myChart3.setOption(option1);
		myChart4.setOption(option1);

		//项目进度
		var option2 = option = {
			color: ['#43DE87', '#337BFC', '#FF584C', '#D8D8D8'],
			tooltip: {
				trigger: 'axis',
				axisPointer: { // 坐标轴指示器，坐标轴触发有效
					type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
				}
			},
			legend: {
				top: "5%",
				itemWidth:10,
				itemHeight:10,
				icon: 'rect',
				data: ['已完成', '进行中', '延期', '待开展'],
			},
			grid: {
				left: '3%',
				right: '4%',
				bottom: '3%',
				containLabel: true
			},
			xAxis: {
				boundaryGap: ['20%', '20%'],
				type: 'value',
				axisLabel: {
					show: false
				},
				axisLine: {
					show: false,
				},
				axisTick: {
					show: false,
				},
				minorTick: {
					show: false
				},
				splitLine: {
					show: false
				},
			},
			yAxis: {
				position: {
					left: 50,
				},
				splitLine: {
					show: false
				},
				nameTextStyle: {
					verticalAlign: 'bottom',
					padding: [3, 4, 10, 20]
				},
				type: 'category',
				axisLine: {
					show: false
				},
				axisTick: {
					show: false,
				},
				data: list.titles,
			},
			series: [{
					name: '已完成',
					type: 'bar',
					barWidth: 20,
					stack: '总量',
					label: {

					},
					data: list.data1,
				},
				{
					name: '进行中',
					type: 'bar',
					stack: '总量',
					label: {

					},
					data: list.data2,
				},
				{
					name: '延期',
					type: 'bar',
					stack: '总量',
					label: {

					},
					data: list.data3,
				},
				{
					name: '待开展',
					type: 'bar',
					stack: '总量',
					label: {

					},
					data: list.data4
				}
			]
		};
		var myChart2 = echarts.init(document.getElementById('main2'));
		myChart2.setOption(option2);
		
		
		$('#select-item').on('tap', function() {
			if ($(".mui-poppicker").hasClass("mui-active")) {
				picker.hide();
				return false;
			} else {
				$("#up").show()
				$("#down").hide()
				picker.setData(selectItems);
				picker.show(function(items) {
					console.log(items[0].text)
					$("#up").hide()
					$("#down").show()
					$("#item_text").html(items[0].text);
				});
			}
		})
	})
	
</script>
