<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>项目概览-首页</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link href="../../../css/mui.min.css" rel="stylesheet" />
		<link href="../../../css/common.css" rel="stylesheet" />
		<style>
			.home-item {
				/* height: 280px; */
				height: 100%;
				/* border-bottom: 6px solid #f6f4f7; */
			}

			.home-item-title {
				font-size: 19px;
				width: 100%;
				height: 20px;
				text-align: left;
				padding: 25px 23px;
				color: #191515;
				font-weight: bold;
			}

			.home-item-title .span-bg {
				width: 78px;
				height: 12px;
				background: rgba(219, 232, 255, 1);
				margin-top: -10px;
			}


			.home-item-list {
				width: 100%;
				margin-top: 23px;
				height: 77px;
				/* height: 107px; */
			}

			.home-item-list .item {
				width: 32%;
				float: left;
				text-align: center;
				font-size: 13px;
				margin-bottom: 24px;
				/* border-bottom: 2px solid #EEEEEE; */

			}

			.home-item-list .item img {
				height: 40px;
				width: 40px;
				border-radius: 40px;
				margin: 0 auto;
				display: block;
				margin-bottom: 10px;
			}

			.mui-icon-forward:before {
				content: '';
			}

			.mui-icon-forward::after {
				content: '\e470';
				font-size: 15px;
			}
			.progress_wrap{
				
				position: absolute;
				background-color: ;
				top: 50%;
				left: 50%;
				width: 80vw;
				/* height: 80vh; */
				transform: translate(-50%,-50%);
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
			}
			.progress_wrap .progress{
				z-index: 9999;
				width: 90%;
				height: 10px;
				border-radius: 15px;
				/* overflow: hidden; */
				border: 3px solid #fff;
				position: relative;
				display: flex;
				flex: 1;
				    background: dimgray;
			}
			.progressStep{
				/* width: 25%; */
				flex: 1;
				height: 100%;
				position: ;
				background-color: ;
				display: inline-block;
				border-right: 2px solid #fff;
				    text-align: right;
				    padding-left: 10px; 
			}
			.progressStep:last-child{
				border-right: none; 
			}
			.progressStep span{
				position: relative;
				top: -24px;
				right: 10px;
				font-size: 12px;
				    color: aliceblue
			}
			.progress_background{
				    background: red;
				    position: absolute;
				    width: 5%;
				    height: 100%;
				    border-radius: 15px;
				    min-width: 5%;
			}
			.progress_background .per{
				position:absolute;
				top: -20px;
				
			}
			.nice_background{
				background:#06c2b7;
				background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
				background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
				-webkit-background-size:20px 20px;background-size:20px 20px;
				-webkit-animation:progressBar 5s linear infinite;
				-o-animation:progressBars 5s linear infinite;
				animation:progressBar 5s linear infinite;
			}
			@keyframes progressBar{
				from{background-position:40px 0}to{background-position:0 0}
			}
			.pagesFix{
				background: rgba(0,0,0,.5);
				position: fixed;
				z-index: 999;
				height: 100vh;
				width: 100vw;
			}
			.mui-navigate-right:after, .mui-push-right:after {
				display: none;
				right: 15px;
				content: '\e583';
			}
			.arrow{
				width: 6px;
				height: 12px;
				margin-top: 7px;
			}
			.mui-table-view-chevron .mui-table-view-cell {
				padding-right: 23px;
			}
			.item-li{
				display: flex;
			}
			.icon-img{
				width: 23px;
				height: 23px;
			}
			.text-word{
				flex-grow: 5;
				line-height: 25px;
				text-align: left;
			}
			.mui-table-view-cell:after {
				position: absolute;
				right: 0;
				bottom: 0;
				left: 0px;
				height: 1px;
				content: '';
				-webkit-transform: scaleY(.5);
				transform: scaleY(.5);
				background-color: #777777;
			}
		</style>

	</head>

	<body>
	<!--页面主结构开始-->
	<div id="app" class="mui-views">
		<div class="mui-view">
			<!-- 			<div class="mui-navbar">
            </div> -->
			<div class="mui-pages">
			</div>
		</div>
	</div>
	<!--页面主结构结束-->
	<!--单页面开始-->
	<div id="mui-content" class="mui-page">
		<!--底部导航栏-->
		<!--页面主内容区开始-->
		<ul id="list" class="mui-table-view mui-table-view-chevron">
			<li class="mui-table-view-cell item-li" id="overview">
				<img class="icon-img"  src="../../../img/project_supervise/overview2x.png" >
				<a class="mui-navigate-right text-word" style="	margin-left: 0px;">
					项目概览
				</a>
				<img class="arrow"  src="../../../img/project_supervise/arrow2x.png">
			</li>
			<li class="mui-table-view-cell item-li" id="quality">
				<img class="icon-img"  src="../../../img/project_supervise/quality2x.png" >
				<a class="mui-navigate-right text-word" style="	margin-left: 0px;">
					质量检查
				</a>
				<img class="arrow quality-arrow"  src="../../../img/project_supervise/arrow2x.png">
			</li>
			<div id="quality-select" style="height: 48px;display: none">
				<div style="border-bottom: 1px solid #777777;display: flex;height: 47px;">
					<div id="quality-routine-check" style="width: 49.5%;color: #1da1f2;line-height: 47px;">日常巡检</div>
					<div style="border-left:1px solid #777777;"></div>
					<div id="quality-special-inspection" style="width: 49.5%;color: #1da1f2;line-height: 47px;">专项巡检</div>
				</div>
			</div>
			<li class="mui-table-view-cell item-li" id="security" >
				<img class="icon-img" src="../../../img/project_supervise/security2x.png" >
				<a class="mui-navigate-right text-word" style="	margin-left: 0px;">
					安全检查
				</a>
				<img class="arrow security-arrow"   src="../../../img/project_supervise/arrow2x.png">
			</li>
			<div id="security-select" style="height: 48px;display: none">
				<div style="border-bottom: 1px solid #777777;display: flex;height: 47px;">
					<div id="security-routine-check" style="width: 49.5%;color: #1da1f2;line-height: 47px;">日常巡检</div>
					<div style="border-left:1px solid #777777;"></div>
					<div id="security-special-inspection" style="width: 49.5%;color: #1da1f2;line-height: 47px;">专项巡检</div>
				</div>
			</div>
			<li class="mui-table-view-cell item-li" id="education">
				<img class="icon-img"  src="../../../img/project_supervise/education2x.png" >
				<a class="mui-navigate-right text-word" style="	margin-left: 0px;">
					安全教育
				</a>
				<img class="arrow"  src="../../../img/project_supervise/arrow2x.png">
			</li>
			<li class="mui-table-view-cell item-li" id="schedule">
				<img class="icon-img"  src="../../../img/project_supervise/education2x.png" >
				<a class="mui-navigate-right text-word" style="	margin-left: 0px;">
					进度管理
				</a>
				<img class="arrow"  src="../../../img/project_supervise/arrow2x.png">
			</li>
			<li class="mui-table-view-cell item-li" id="attendance" style="display: none">
				<img class="icon-img"  src="../../../img/project_supervise/attendance2x.png" >
				<a class="mui-navigate-right text-word" style="	margin-left: 0px;">
					现场考勤
				</a>
				<img class="arrow"  src="../../../img/project_supervise/arrow2x.png">
			</li>
			<li class="mui-table-view-cell item-li" id="meeting">
				<img class="icon-img"  src="../../../img/project_supervise/meeting2x.png" >
				<a class="mui-navigate-right text-word" style="	margin-left: 0px;">
					会议签到
				</a>
				<img class="arrow"  src="../../../img/project_supervise/arrow2x.png">
			</li>
		</ul>
		<!--页面主内容区结束-->
	</div>
		

	</body>
	<script src="../../../js/mui.min.js"></script>
	<script src="../../../js/mui.view.js"></script>
	<script src="../../../js/mui.locker.js"></script>
	<script src="../../../js/engineering.js"></script>
	<script src="../../../js/app.js"></script>
	<script src="../../../js/config.js"></script>
	<script src="../../../js/overview.js"></script>
	<script src="../../../js/update.js"></script>
	<script src="../../../js/helper.js"></script>
	<script src="../../../js/jquery.min.js"></script>
	<script src="../../../js/common.js"></script>
	<script src="../../../js/s4.js"></script>
	<script src="../../../js/smutils.js"></script>
	<script src="../../../js/byte&string.js"></script>
	<script src="../../../js/ajaxhook.min.js"></script>
	<!-- <script src="../../js/vconsole.min.js"></script> -->
	
	<script>
		mui.init({swipeBack:false});

		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#mui-content'
		});
		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();
		mui.ready(function() {});
		var projectInfo = "";//存储上一次查看的信息：包括项目信息
		var extras={
			target:"",
			targetName:"",
			pageCount:1
		}
		mui.plusReady(function() {
			var self = plus.webview.currentWebview();
			console.log("进入项目功能页面")
			console.log(JSON.stringify(self))
			projectInfo=JSON.parse(localStorage.getItem("projectInfo"))
			selProject()

			var myProjectId = {
				userName:JSON.parse(localStorage.getItem('$state')).account,
				projectId: self.prjId
			};

			isAttendance(myProjectId)

		})


		var getLoc = function(param, callback) {
			var url = config.urls.baseUrl + config.actions.getLoc;
			console.log(JSON.stringify(param));
			$.ajax(url, {
				data: param,
				// data: "",
				dataType: 'json', //服务器返回json格式数据
				type: 'get', //HTTP请求类型
				headers: {
					"Content-Type": "application/x-www-form-urlencoded",
					"X-Access-Token": app.sessionId(),
				},
				timeout: config.settings.requestTimeOut, //超时时间设置为10秒；
				success: function(data) {
					console.log("=====================================")
					console.log(JSON.stringify(data))
					// app.hideLoader();
					if (dealingWithResponseCode(data)) {
						callback(data);
						// mui.alert(data.message)
					} else {
						// app.toast(data.message);
					}
				},
				error: function(xhr, type, errorThrown) {
					console.log(type)
					dealingWithErrorRequest(errorThrown);
					app.hideLoader();
					return callback('网络异常,请稍后再试');
				}
			});
		};

		function isAttendance(param) {
			getLoc(param,function (data) {
				if (data.result.length > 0){
					$('#attendance').show()
				}

			})
		}



		function selectProject(param, callback) {
			var url = config.urls.baseUrl + config.actions.selectProject;

			app.showLoader();
			$.ajax(url, {
				data:param,
				dataType: 'json', //服务器返回json格式数据
				type: 'GET', //HTTP请求类型
				headers: {
					// "Content-Type": "application/json",
					"Content-Type": "application/x-www-form-urlencoded",
					"X-Access-Token": app.sessionId(),
				},
				timeout: config.settings.requestTimeOut, //超时时间设置为10秒；
				success: function(data) {
					app.hideLoader();
					if (dealingWithResponseCode(data)) {
						callback(data);
						// mui.alert(data.message)
					} else {
						app.toast(data.message);
					}
				},
				error: function(xhr, type, errorThrown) {
					var res = xhr.responseText;
					res = JSON.parse(res)
					mui.alert(res.message)
					dealingWithErrorRequest(errorThrown);
					app.hideLoader();
					return callback('网络异常,请稍后再试');
				}
			});
		};
		// 项目概览
		$("#overview").on('tap', function() {
			selProject()


			var extras = {
				guid:projectInfo.prjId,
				proCode:projectInfo.prjCode
			}


			app.openPage("../projectDetail.html", {
				titleNView: {
					titleText: '项目概览',
					autoBackButton: true,
				}
			}, extras);

			// extras.target="./overviewOne.html";
			// extras.targetName="项目概览";
			// if (isEmpty(projectInfo)) {
			// 	app.openPage("./overview/projectList.html", {
			// 		titleNView: {
			// 			titleText: '项目概览',
			// 			autoBackButton: true,
			// 		},
			// 	},extras);
			// }
			// app.openPage("./overviewOne.html", {
			// 	titleNView: {
			// 		titleText: '项目概览',
			// 		autoBackButton: true,
			// 	},
			// });
		});

		// 质量检查
		var quality_arrow = true
		$("#quality").on('tap', function() {

			if (quality_arrow){
				$('.quality-arrow').css('transform','rotate(270deg)')
				quality_arrow = false
				$('#quality-select').show()
			}else {
				$('.quality-arrow').css('transform','rotate(0deg)')
				quality_arrow = true
				$('#quality-select').hide()
			}

			/*之前逻辑
			selProject()
			extras.target="../quality/index.html";
			extras.targetName="质量检查";
			if (isEmpty(projectInfo)) {
				app.openPage("./projectList.html", {
					titleNView: {
						titleText: '项目概览',
						autoBackButton: true,
					},
				},extras);
			}
			app.openPage("../quality/index.html", {
				titleNView: {
					titleText: '质量检查',
					autoBackButton: true,
				},
			});
			 */
			
		});
		//日常巡检
		$("#quality-routine-check").on('tap', function() {
			app.openPage("../quality/qualityDailyInspection.html", {
				titleNView: {
					titleText: '日常巡检',
					autoBackButton: true,
				},
			});
		})
		//专项巡检
		$("#quality-special-inspection").on('tap', function() {
			app.openPage("../quality/qualitySpecialInspection.html", {
				titleNView: {
					titleText: '专项巡检',
					autoBackButton: true,
				},
			});
		})


		var security_arrow = true
		// 安全检查
		$("#security").on('tap', function() {
			if (quality_arrow){
				$('.security-arrow').css('transform','rotate(270deg)')
				quality_arrow = false
				$('#security-select').show()
			}else {
				$('.security-arrow').css('transform','rotate(0deg)')
				quality_arrow = true
				$('#security-select').hide()
			}
		/*之前逻辑
			selProject()
			extras.target="../security/index.html";
			extras.targetName="安全检查";
			if (isEmpty(projectInfo)) {
				app.openPage("./projectList.html", {
					titleNView: {
						titleText: '项目概览',
						autoBackButton: true,
					},
				},extras);
			}
			app.openPage("../security/index.html", {
				titleNView: {
					titleText: '安全检查',
					autoBackButton: true,
				},
			});
		 */
	});
	//日常巡检
	$("#security-routine-check").on('tap', function() {
		app.openPage("../security/dailyInspection.html", {
			titleNView: {
				titleText: '日常巡检',
				autoBackButton: true,
			},
		});
	})
	//专项巡检
	$("#security-special-inspection").on('tap', function() {
		app.openPage("../security/specialInspection.html", {
			titleNView: {
				titleText: '专项巡检',
				autoBackButton: true,
			},
		});
	})


	// 安全教育
	$("#education").on('tap', function() {
		// selProject()
		// extras.target="../education/index.html";
		// extras.targetName="安全教育";
		// if (isEmpty(projectInfo)) {
		//     app.openPage("./projectList.html", {
		//         titleNView: {
		//             titleText: '项目概览',
		//             autoBackButton: true,
		//         },
		//     },extras);
		// }
		app.openPage("../education/index.html", {
			titleNView: {
				titleText: '安全教育',
				autoBackButton: true,
			},
		});
	});
	//进度管理
	$("#schedule").on('tap',function(){
		debugger
		var extras = {
			prjName:projectInfo.prjName,
			prjId:projectInfo.prjId
		}
		app.openPage("../schedule/index.html", {
			titleNView: {
				titleText: projectInfo.prjName,
				autoBackButton: true,
			},
		},extras);
	})
// 现场考勤
//5 {"__view_array__":[],"__IDENTITY__":"NWindow","__uuid__":"NWindow131622512090838","__callbacks__":{"back":[null],"menu":[null]},"__callback_id__":"plus21622512091322","id":"project_index.html","prjId":"ed47fe7053ca6bfcbbd6114fb348f56c","prjName":"诶皮皮","prjCode":"prj172","pageCount":1,"prjNo":"FT2021062","prjType":"9c69a24fa484ec6be300332447e68904"} at view/engineering/overview/project_index.html:281
// {"prjId":"78ac542dfd7827129476956269d755d0","prjName":"525测试项目","prjCode":"prj214","pageCount":1,"prjNo":"FT2021053","prjType":"a07af2eb4e5e4f9cf462fd625db77f2f"} at view/engineering/overview/project_index.html:477
$("#attendance").on('tap', function() {
    console.log("进入考勤页面")
    projectInfo.prjId = self.prjId;
    projectInfo.prjName = self.prjName;
    projectInfo.prjCode = self.prjCode;
    projectInfo.pageCount = self.pageCount;
    projectInfo.prjNo = self.prjNo;
    projectInfo.prjType = self.prjType;
    extras.target="../attendance/month.html";
    extras.targetName="现场考勤";
    app.openPage("../attendance/month.html", {
        titleNView: {
            titleText: '现场考勤',
            autoBackButton: true,
        },
    },projectInfo);
});
// 项目会议
$("#meeting").on('tap', function() {
    selProject()
    extras.target="../meeting/index.html";
    extras.targetName="会议签到";
    // if (isEmpty(projectInfo)) {
        app.openPage("../meeting/index.html", {
            titleNView: {
                titleText: extras.targetName,
                autoBackButton: true,
            },
        },extras);
    // }
    // app.openPage("./meeting/index.html", {
    // 	titleNView: {
    // 		titleText: '会议签到',
    // 		autoBackButton: true,
    // 	},
    // });
});

function exitProject(param, callback) {
    console.log(JSON.stringify(param))
    var url = config.urls.baseUrl + config.actions.exitProject;
    // app.showLoader();
    $.ajax(url, {
        data:'',
        dataType: 'json', //服务器返回json格式数据
        type: 'GET', //HTTP请求类型
        headers: {
            // "Content-Type": "application/json",
            "Content-Type": "application/x-www-form-urlencoded",
            "X-Access-Token": app.sessionId(),
        },
        timeout: config.settings.requestTimeOut, //超时时间设置为10秒；
        success: function(data) {
            // app.hideLoader();
            if (dealingWithResponseCode(data)) {
                callback(data);
                // mui.alert(data.message)
            } else {
                app.toast(data.message);
            }
        },
        error: function(xhr, type, errorThrown) {
            // var res = xhr.responseText;
            // res = JSON.parse(res)
            // mui.alert(res.message)
            dealingWithErrorRequest(errorThrown);
            // app.hideLoader();
            return callback('网络异常,请稍后再试');
        }
    });
};
mui.back=function(){
    exitProject('', (res) => {
        console.log(res)
        plus.webview.currentWebview().close('none')
    })
}
function selProject(){
    if(!isEmpty(projectInfo)){
        projectInfo=JSON.parse(localStorage.getItem("projectInfo"))
        console.log(JSON.stringify(projectInfo))
        selectProject({'prjCode':projectInfo.prjCode},(res)=>{
            console.log(JSON.stringify(res))
        })
    }
}
</script>

</html>
