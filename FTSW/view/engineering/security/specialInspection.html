<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>专项巡检</title>

		<link href="../../../css/mui.min.css" rel="stylesheet" />
		<link href="../../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../../css/mui.poppicker.css" rel="stylesheet" />
		<link href="../../../css/common.css" rel="stylesheet" />
		<link href="../../../css/ps.css" rel="stylesheet"/>
		<style type="text/css">

			
			.header a,
			.header h1 {
				color: #fff;
			}
			

			
			.mui-table-view-cell img {
				width: 7px;
				height: 12px;
				float: right;
			}
			

			
			.table-bnt p {
				color: #000;
				width: 45%;
				margin-bottom: 10px;
			}
			
			.table-bnt p span {
				color: #888888;
			}

			
			.menu_bottom button {
				width: 120px;
				height: 40px;
			}

			.zt span{
				font-size: 12px;
			}
			.mui-table-view-cell p{
				display: inline-block;
			}
			/*遮罩*/
			.mark1{
				/*z-index: 9998;*/
				z-index: 9;
				position: fixed;
				top: 0px;
				left: 0px;
				right: 0px;
				bottom: 0px;
				background: rgba(0,0,0,0.5);
				display: none;
			}
			.mark2{
				/*z-index: 9998;*/
				z-index: 9;
				position: fixed;
				top: 0px;
				left: 0px;
				right: 0px;
				bottom: 0px;
				background: rgba(0,0,0,0.5);
				display: none;
			}
			.box-shadow{
				 margin-left: 5%;
				 width: 90%;
				 height: 100px;
				 background-color: #FFF;
				 box-shadow: 0 0px 10px 0 rgb(0 0 0 / 20%);
				 border-radius: 5px;
				 -moz-border-radius: 25px;
				 margin: 5%;
			 }

			.box-shadow2{
				margin-left: 5%;
				width: 90%;
				height: 150px;
				background-color: #FFF;
				box-shadow: 0 0px 10px 0 rgb(0 0 0 / 20%);
				border-radius: 5px;
				-moz-border-radius: 25px;
				margin: 5%;
			}

			/*.info-bar-content-item .item-input input {*/
			/*	border: none;*/
			/*	padding: 0;*/
			/*	!* text-align: right; *!*/
			/*	font-size: 14px;*/
			/*	font-weight: 400;*/
			/*	color: #191515;*/
			/*	margin-bottom: 10px;*/
			/*	!* padding-right: 30px; *!*/
			/*}*/

			.img-right-arrow {
				width: 7px;
				height: 12px;
				margin-left: 5px;
			}

			.info-bar-content-item .item-title {
				text-align: left;
				padding: 0px 0px 0px 0px;
				color: #444444;
				display: inline-block;
				vertical-align: top;
				line-height: 20px;
			}

			.item-title{
				font-size: 14px;
				font-weight: 400;
				color: #444444;
			}

			.file_upload{
				padding: 3px 0;
				width: 90px;
				/*background: #337BFC;*/
				background: white;
				border: none;
				color: #0493F3;
				text-align: right;
				font-size: 16px;
				/*border: 1px solid #337BFC;*/
				/*border-radius: 26px;*/
			}

			.btn-label{
				font-size: 12px;
				font-weight: 400;
				color: #B1B1B1;
				line-height: 14px;
			}


			/* 滚动指示器 */

			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				border-bottom: 1px solid #FFFFFF;
			}

			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active:after {
				/*color: #007aff;*/
				border-bottom: 2px solid #007aff;
				background: 0 0;
				content: '';
				width: 24px;
				display: block;
				margin: 0 auto;
			}


		</style>
	</head>

	<body>
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--右侧栏内容-->
		<div id="leftLan1" class="side1" style="position:fixed;z-index: 10;width:270px;height: 100vh;right:-270px;">
			<div class="mui-scroll" style="height:100vh;background-color: white;color: black;width: 270px;">
				<!--侧栏具体展示内容-->
				<p style="padding: 5px 20px;margin-bottom: 20px;"></p>

				<div class="info-bar-content-item">
					<div class="item-title">
						检查项：
					</div>
					<div class="mui-input-row item-input">
						<input id="check_items" style="text-align: left" required="true" placeholder="请输入检查项"/>
					</div>
				</div>
				<div class="info-bar-content-item">
					<div class="item-title">
						检查人：
					</div>
					<div class="mui-input-row item-input">
						<input id="examiner1" style="text-align: left" required="true" placeholder="请输入检查人"/>
					</div>
				</div>
				<div class="info-bar-content-item" style="height: 51px">
					<div class="item-title" style="width: 50%">
						检查开始时间：
					</div>
					<div class="mui-input-row item-input">
						<span id="processingDemands11">请选择时间</span>
						<img id="processingDemandsImg11" src="../../../img/cal.png"
							 style="width: 16px;height: 16px;margin: auto 0px auto 5px"/>
					</div>
				</div>
				<div class="info-bar-content-item" style="height: 51px">
					<div class="item-title" style="width: 50%">
						检查结束时间：
					</div>
					<div class="mui-input-row item-input" style="">
						<span id="processingDemands12">请选择时间</span>
						<img id="processingDemandsImg12" src="../../../img/cal.png"
							 style="width: 16px;height: 16px;margin: auto 0px auto 5px"/>
					</div>
				</div>
				<!--分隔-->

				<div class="but1" style="bottom:30px;display: flex;justify-content: space-around; margin-top: 50vh;">
						<button id="redo1" type="button" class="mui-btn mui-btn-primary mui-btn-outlined mui-btn-block" style="width:46%;float:left;padding: 5px 20px;margin-right: 5px">重 置</button>
						<button id="searchByFactor1" type="button" class="mui-btn mui-btn-primary mui-btn-block" style="width:46%;float:left;padding: 5px 20px;">搜 索</button>
				</div>

			</div>
		</div>
		<div id="leftLan2" class="side2" style="position:fixed;z-index: 10;width:270px;height: 100vh;right:-270px;">
			<div class="mui-scroll" style="height:100vh;background-color: white;color: black;width: 270px;">
				<!--侧栏具体展示内容-->
				<p style="padding: 5px 20px;margin-bottom: 20px;"></p>

				<div class="info-bar-content-item">
					<div class="item-title">
						监理单位：
					</div>
					<div class="mui-input-row item-input">
						<input id="construction_unit" style="text-align: left" required="true" placeholder="请输入监理单位"/>
					</div>
				</div>
				<div class="info-bar-content-item">
					<div class="item-title">
						填写人：
					</div>
					<div class="mui-input-row item-input">
						<input id="completed_by" style="text-align: left" required="true" placeholder="请输入填写人"/>
					</div>
				</div>
				<div class="info-bar-content-item">
					<div class="item-title">
						状态：
					</div>
					<div class="mui-input-row item-input">
						<span id="status">请选择</span>
						<img src="../../../img/arrow-right-gray.png" class="img-right-arrow"/>
					</div>
				</div>
				<div class="info-bar-content-item" style="height: 51px">
					<div class="item-title" style="width: 50%">
						检查开始时间：
					</div>
					<div class="mui-input-row item-input">
						<span id="processingDemands21">请选择时间</span>
						<img id="processingDemandsImg21" src="../../../img/cal.png"
							 style="width: 16px;height: 16px;margin: auto 0px auto 5px"/>
					</div>
				</div>
				<div class="info-bar-content-item" style="height: 51px">
					<div class="item-title" style="width: 50%">
						检查结束时间：
					</div>
					<div class="mui-input-row item-input" style="">
						<span id="processingDemands22">请选择时间</span>
						<img id="processingDemandsImg22" src="../../../img/cal.png"
							 style="width: 16px;height: 16px;margin: auto 0px auto 5px"/>
					</div>
				</div>
				<!--分隔-->

				<div class="but1" style="bottom:30px;display: flex;justify-content: space-around; margin-top: 50vh;">
					<button id="redo2" type="button" class="mui-btn mui-btn-primary mui-btn-outlined mui-btn-block" style="width:46%;float:left;padding: 5px 20px;margin-right: 5px">重 置</button>
					<button id="searchByFactor2" type="button" class="mui-btn mui-btn-primary mui-btn-block" style="width:46%;float:left;padding: 5px 20px;">搜 索</button>
				</div>

			</div>
		</div>
		<!-- 遮罩 -->
		<div class="mark1"></div>
		<div class="mark2"></div>

		<div id="mui-content" class="mui-page">
			<div class="mui-page-content">


				<div class="" id="slider" style="background: rgb(242, 242, 242)">
					<div id="slider-item" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="background: #FFF">
						<a class="mui-control-item mui-active" id="title-item1" href="#item1">安全检查</a>
						<a class="mui-control-item " id="title-item2" href="#item2">安全整改</a>
					</div>
					<div class="mui-slider-group" style="background: #FFF;">
						<div id="item1" class="mui-slider-item mui-control-content mui-active" style="overflow-y: auto;border-top: none;border-top: 5px solid #f4f4f4;">
							<div id="openFactor1" >
								<div class="view-title search-tip" style="display: flex;padding: 20px 0px 0px 0px;">
									<div style="width: 70%">
										<img src="../../../img/fujin-icon.png" style="width: 16px;height: 15px;line-height: 15px;vertical-align:middle;margin-left: -80px" />
										<span id="label1" style="line-height: 16px;">检查清单</span>
										<span id="num1" style="color: #337BFC;font-weight:bold;margin-left: 10px;">0</span>
									</div>
									<div style="width: 30%">
										<img id="moreFactor1" style="width: 20px" src="../../../img/commom/sideLan.png" />
									</div>
								</div>
							</div>
							<div class="safety-form">

							</div>
						</div>
						<div id="item2" class="mui-slider-item mui-control-content" style="overflow-y: auto;border-top: none;border-top: 5px solid #f4f4f4;background: #FFF;">
							<div id="openFactor2" >
								<div class="view-title search-tip" style="display: flex;padding: 20px 0px 0px 0px;">
									<div style="width: 70%">
										<img src="../../../img/fujin-icon.png" style="width: 16px;height: 15px;line-height: 15px;vertical-align:middle;margin-left: -80px" />
										<span id="label2" style="line-height: 16px;">整改清单</span>
										<span id="num2" style="color: #337BFC;font-weight:bold;margin-left: 10px;">0</span>
									</div>
									<div style="width: 30%">
										<img id="moreFactor2" style="width: 20px" src="../../../img/commom/sideLan.png" />
									</div>
								</div>
							</div>
							<div class="rectification-form">
<!--								<div>-->
<!--									<div class="box-shadow2" style="display: flex;flex-direction: column">-->
<!--										<div style="height: 33%;display: flex">-->
<!--											<div style="width: 50%;padding: 13px 0px 0px 24px;text-align: left"><span style='width:120px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;'>1 整体进度</span></div>-->
<!--											<div id="demo" class="mui-progressbar" style="margin-top: 20px;height: 8px;">-->
<!--												<span style="color: red"></span>-->
<!--											</div>-->
<!--											<div style="width: 30%;margin-top: 14px;"><span style="color: #2E64F0">1/5</span></div>-->
<!--										</div>-->
<!--										<div style="border-bottom: 1px solid rgb(0 0 0 / 20%)"></div>-->
<!--										<div style="height: 66%;display: flex;flex-direction: column">-->
<!--											<div style="display: flex">-->
<!--												<div style="font-size: 13px;padding: 14px 0px 0px 25px;color: #888888FF">监理单位:</div>-->
<!--												<div style="font-size: 13px;padding: 14px 0px 0px 10px;color: #262626FF;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">中国电建集团华东勘测设计研究院有限公司</div>-->
<!--											</div>-->
<!--											<div style="display: flex">-->
<!--												<div style="font-size: 13px;padding: 14px 0px 0px 25px;color: #888888FF">检查日期:</div>-->
<!--												<div style="font-size: 13px;padding: 14px 0px 0px 4px;color: #262626FF">2020-01-12</div>-->
<!--												<div style="font-size: 13px;padding: 14px 0px 0px 25px;color: #888888FF">逾期情况:</div>-->
<!--												<div style="color: #888888FF;border: 1px solid #0493F3FF;margin-top: 13px;height: 21px;margin-left: 4px;"><span style="color: #0493F3FF">剩余14天</span></div>-->
<!--											</div>-->
<!--										</div>-->
<!--									</div>-->
<!--								</div>-->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</body>

	<script src="../../../js/mui.min.js"></script>
	<script src="../../../js/mui.view.js"></script>
	<script src="../../../js/mui.locker.js"></script>

	<script src="../../../js/app.js"></script>
	<script src="../../../js/config.js"></script>
	<script src="../../../js/security.js"></script>
	<script src="../../../js/update.js"></script>
	<script src="../../../js/helper.js"></script>
	<script src="../../../js/jquery.min.js"></script>
	<script src="../../../js/common.js"></script>
	<script src="../../../js/s4.js"></script>
	<script src="../../../js/smutils.js"></script>
	<script src="../../../js/byte&string.js"></script>
	<script src="../../../js/ajaxhook.min.js"></script>
	<script src="../../../js/mui.picker.min.js"></script>
	<script src="../../../js/mui.picker.js"></script>
	<script src="../../../js/mui.poppicker.js"></script>
	<script src="../../../js/vconsole.min.js"></script>
	<script src="../../../js/inspection/dailyInspection.js"></script>
	<script type="text/javascript">
		//初始化单页view

		var height = document.documentElement.clientHeight
		$('.but1').css('margin-top',(height-300)+'px')

		var viewApi = mui('#app').view({
			defaultPage: '#mui-content'
		});
		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();
		// mui.ready(function() {});
		mui.init({
			swipeBack:false,
		});

		var userPicker = new mui.PopPicker();

		// mui("#demo1").progressbar({progress:20}).show();
		// mui("#demo3").progressbar({progress:0.5}).show();




		//时间选择
		$('#processingDemandsImg11,#processingDemandsImg12').on('tap',function () {
			var that = $(this);
			plusDate(function(data) {

				console.log(JSON.stringify(data))
				if (that.attr("id") == "processingDemandsImg11"){
					$('#processingDemands11').text(data)
					requestSafetyParam.minCreateTime = data+' 00:00:00'
				}else if(that.attr("id") == "processingDemandsImg12"){
					$('#processingDemands12').text(data)
					requestSafetyParam.maxCreateTime = data+' 23:59:59'
				}

				if (that.attr("id") == "processingDemandsImg11" && $("#processingDemands12").val() != '' && $("#processingDemands12").val() < data) {
					app.toast("检查开始时间不得晚于检查结束时间")
				} else if (that.attr("id") == "processingDemandsImg12" && $("#processingDemands11").val() != '' && $("#processingDemands11").val() > data) {
					app.toast("检查结束时间不得晚于检查开始时间")
				} else that.val(data)
			});
		})

		$('#processingDemandsImg21,#processingDemandsImg22').on('tap',function () {
			var that = $(this);
			plusDate(function(data) {

				console.log(JSON.stringify(data))
				if (that.attr("id") == "processingDemandsImg21"){
					$('#processingDemands21').text(data)
					requestRectificationParam.minCreateTime = data+' 00:00:00'
				}else if(that.attr("id") == "processingDemandsImg22"){
					$('#processingDemands22').text(data)
					requestRectificationParam.maxCreateTime = data+' 23:59:59'
				}

				if (that.attr("id") == "processingDemandsImg21" && $("#processingDemands22").val() != '' && $("#processingDemands22").val() < data) {
					app.toast("检查开始时间不得晚于检查结束时间")
				} else if (that.attr("id") == "processingDemandsImg22" && $("#processingDemands21").val() != '' && $("#processingDemands21").val() > data) {
					app.toast("检查结束时间不得晚于检查开始时间")
				} else that.val(data)
			});
		})



		var this_id = 'title-item1'


		var requestSafetyParam = {
			projectId: '',
			maxCreateTime: '',
			minCreateTime: '',
			inputFullname: '',
			checkItemName: '',
			column: 'createTime',
			order: 'desc'
		}

		var requestRectificationParam = {
			projectId: '',
			column: 'createTime',
			order: 'desc',
			state:'',
			projectName:'',
			superviceUnitFullname:'',
			inputerfullname:'',
			minCreateTime:'',
			maxCreateTime:''
		}

		mui.plusReady(function() {
			var curr = plus.webview.currentWebview();

			projectInfo=JSON.parse(localStorage.getItem("projectInfo"))
			// console.log('ass'+JSON.stringify(projectInfo))

			requestSafetyParam.projectId = projectInfo.prjId
			requestRectificationParam.projectId = projectInfo.prjId
			querySafetyInspectionFormMain(requestSafetyParam)
			querySafetyRectificationFormMian(requestRectificationParam)
			curr.setStyle({
				titleNView: {
					buttons: [{
						float: 'right',
						width: '60',
						fontSize: '25',
						text: '＋',
						onclick: function() {
							let extras={ type:"add"}
							if(this_id == 'title-item1') {
								app.openPage("addSafetyInspectionForm.html", {
									titleNView: {
										titleText: '新增安全检查表单',
										autoBackButton: true,
									}
								}, extras);
							}else {
								app.openPage("addSafetyRectificationForm.html", {
									titleNView: {
										titleText: '新增安全整改表单',
										autoBackButton: true,
									}
								}, extras);
							}
						}
					}]
				}
			});

		})

		//侧栏1点击显示
		$("#moreFactor1").on('tap',function () {
			$('.mark1').fadeIn();
			$('.side1').css('right',0);
		})

		// 点击页面遮罩和侧栏消失
		$('.mark1 ').click(function(){
			$('.mark1').fadeOut();
			$('.side1').css('right',-270);
		})


		//侧栏2点击显示
		$("#moreFactor2").on('tap',function () {
			$('.mark2').fadeIn();
			$('.side2').css('right',0);
		})

		// 点击页面遮罩和侧栏消失
		$('.mark2').click(function(){
			$('.mark2').fadeOut();
			$('.side2').css('right',-270);
		})

		//进入安全检查详情页面
		$('.safety-form').on('tap','.arrow',function () {
			var arrow_id = $(this).attr("id")
			var pj_id = arrow_id.substring(5,arrow_id.length);
			// console.log(pj_id)
			var pj_guid = $('#pj_guid'+pj_id+'').val()
			// console.log(pj_guid)
			let extras = {
				guid:pj_guid,
				projectId: projectInfo.prjId
			}
			app.openPage("showSafetyInspectionForm.html", {
				titleNView: {
					titleText: '查看安全检查表单',
					autoBackButton: true,
				}
			},extras);
		})
		$('.safety-form').on('tap','.safety-son',function () {
			var arrow_id = $(this).attr("id")
			var pj_id = arrow_id.substring(5,arrow_id.length);
			console.log(pj_id)
			var pj_guid = $('#pj_guid'+pj_id+'').val()
			// console.log(pj_guid)
			let extras = {
				guid:pj_guid,
				projectId: projectInfo.prjId
			}
			app.openPage("showSafetyInspectionForm.html", {
				titleNView: {
					titleText: '查看安全检查表单',
					autoBackButton: true,
				}
			},extras);
		})

		//进入安全整改详情页面
		$('.rectification-form').on('tap','.safe-son',function () {
			var arrow_id = $(this).attr("id")
			var sf_id = arrow_id.substring(5,arrow_id.length);
			console.log(sf_id)
			var sf_guid = $('#sf_guid'+sf_id+'').val()
			console.log(sf_guid)

			let extras = {
				guid:sf_guid,
				projectId: projectInfo.prjId
			}

			app.openPage("showSafetyRectificationForm.html", {
				titleNView: {
					titleText: '查看安全整改表单',
					autoBackButton: true,
				}
			},extras);
		})

		//监听选择新增安全检查或者安全整改
		$('.mui-control-item').on('tap',function () {
			this_id =  $(this).attr('id');
		})



		//重置按钮
		$('#redo1').on('tap',function () {

			$('#processingDemands11').text('请选择时间')
			$('#processingDemands12').text('请选择时间')
			requestSafetyParam.maxCreateTime = ''
			requestSafetyParam.minCreateTime = ''
			requestSafetyParam.checkItemName = ''
			requestSafetyParam.inputFullname = ''
			$('#check_items').val('')
			$('#examiner1').val('')

		})

		$('#redo2').on('tap',function () {

			$('#processingDemands21').text('请选择时间')
			$('#processingDemands22').text('请选择时间')
			requestRectificationParam.maxCreateTime = ''
			requestRectificationParam.minCreateTime = ''
			requestRectificationParam.state = ''
			requestRectificationParam.superviceUnitFullname = ''
			requestRectificationParam.inputerfullname = ''
			$('#construction_unit').val('')
			$('#completed_by').val('')
			$('#status').text('请选择')

		})

		//搜索按钮
		$('#searchByFactor1').on('tap',function () {
			requestSafetyParam.checkItemName = '*'+$('#check_items').val()+'*'
			requestSafetyParam.inputFullname = '*'+$('#examiner1').val()+'*'
			querySafetyInspectionFormMain(requestSafetyParam)
			$('.mark1').fadeOut();
			$('.side1').css('right',-270);
		})

		$('#searchByFactor2').on('tap',function () {
			requestRectificationParam.superviceUnitFullname = '*'+$('#construction_unit').val()+'*'
			requestRectificationParam.inputerfullname = '*' + $('#completed_by').val() + '*'
			querySafetyRectificationFormMian(requestRectificationParam)
			$('.mark2').fadeOut();
			$('.side2').css('right',-270);
		})

		//状态筛选
		$("#status").on("tap", function() {
			var that = $(this);
			var data = ['暂存','流转中','已完成','废弃'];
			var resultJSON = [];
			for (var i = 0; i < data.length; i++) {
				var item = data[i];
				resultJSON.push({
					text: item,
					value: (i)
				})
			}
			if ($(".mui-poppicker").hasClass("mui-active")) {
				userPicker.hide();
				return false;
			} else {
				userPicker.setData(resultJSON);
				userPicker.show(function(items) {
					$("#status").text(items[0].text);
					requestRectificationParam.state=items[0].value
				});
			}
			// })
		})




		//安全检查列表
		function querySafetyInspectionFormMain(param){
			querySafetyInspectionForm(param,function (data) {
				// console.log(JSON.stringify(data))
				addSafetyDataList(data.result.records)
			})
		}


		//安全整改列表
		function querySafetyRectificationFormMian(param) {
			querySafetyRectificationForm(param,function (data) {
				console.log(JSON.stringify(data))
				addSafetyRectificationList(data.result.records)
			})
		}


		//动态安全检查拼接数据
		function addSafetyDataList(data) {

			var html = ''

			// console.log(JSON.stringify(data))
			// console.log(data.length)


			for (let i = 0; i < data.length; i++) {

				html +='<div  id="s-son'+(i+1)+'" class="safety-son">\n' +
						'   <div class="box-shadow" style="display: flex;flex-direction: column">\n' +
						'       <div style="height: 49%;display: flex">\n' +
						'       <div style="width: 70%;padding: 13px 0px 0px 24px;text-align: left;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;"><span style=\'width:120px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;\'>'+(i+1)+' '+data[i].checkItemName+'</span></div>\n' +
						'       <div style="width: 30%;padding: 13px 0px 0px 30px;">\n' +
						'       <img id="arrow'+(i+1)+'" class="arrow quality-arrow" style="width: 10px"  src="../../../img/project_supervise/arrow2x.png">\n' +
						'   </div>\n' +
						'  </div>\n' +
						'       <div style="border-bottom: 1px solid rgb(0 0 0 / 20%)"></div>\n' +
						'       <div style="height: 49%;display: flex">\n' +
						'       <div style="width: 40%;font-size: 13px;padding: 14px 0px 0px 10px;">检查人：'+data[i].inputFullname+'</div>\n' +
						'       <div style="width: 60%;font-size: 13px;padding: 14px;">检查日期：'+data[i].checkTime.substring(0,11)+'</div>\n' +
						'       <input id="pj_guid'+(i+1)+'" type="text" value="'+data[i].guid+'" style="display: none">\n' +
						'        </div>\n' +
						'   </div>\n' +
						'</div>'

			}
			if(data.length==0){
				var html2 = '<div style="padding: 40px; height: 80px;">\n' +
						'\t\t\t\t\t\t暂无数据\n' +
						'\t\t\t\t\t</div>'
				$('.safety-form').html(html2)
			}else {
				$('.safety-form').html(html)
			}

			$('#num1').text(data.length)

		}



		//动态安全整改检查拼接数据
		function addSafetyRectificationList(data) {
				var html = ''

			var color = ['#4bcc61','#cc150e','#2E64F0']
			var rectificationRateArr = new Array()
			for (let i = 0; i < data.length; i++) {

				var fontColor = null;
				var dateStr = null
				var barColor = null
				var dateDiff = (GetDateDiff(getNowFormatDate().substring(0,11),data[i].rectifyTime.substring(0,11),'day'))-1
				if(dateDiff<0){
					fontColor = color[1]
					dateDiff +='';
					dateStr = '逾期'+dateDiff.substring(1,dateDiff.length)+'天'
					barColor = color[1]
				}else {
					fontColor = color[0]
					dateStr = '剩余'+dateDiff+'天'
					barColor = color[2]
				}

				rectificationRateArr.push(data[i].rectificationRate)


				html +='<div id="safey'+(i+1)+'" class="safe-son">\n' +
						'\t\t\t\t\t\t\t\t\t<div class="box-shadow2" style="display: flex;flex-direction: column">\n' +
						'\t\t\t\t\t\t\t\t\t\t<div style="height: 33%;display: flex">\n' +
						'\t\t\t\t\t\t\t\t\t\t\t<div style="width: 50%;padding: 13px 0px 0px 24px;text-align: left"><span style=\'width:120px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;\'>'+(i+1)+' '+' 整体进度</span></div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t<div id="demo'+(i+1)+'" class="mui-progressbar" style="margin-top: 20px;height: 8px;">\n' +
						'\t\t\t\t\t\t\t\t\t\t\t\t<span style="background-color: '+barColor+'"></span>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t<div style="width: 30%;margin-top: 14px;"><span style="color: #2E64F0">'+data[i].successCheckItem+'/'+data[i].questionCheckItem+'</span></div>\n' +
						'\t\t\t\t\t\t\t\t\t\t</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t<div style="border-bottom: 1px solid rgb(0 0 0 / 20%)"></div>\n' +
						'\t\t\t\t\t\t\t\t\t\t<div style="height: 66%;display: flex;flex-direction: column">\n' +
						'\t\t\t\t\t\t\t\t\t\t\t<div style="display: flex">\n' +
						'\t\t\t\t\t\t\t\t\t\t\t\t<div style="font-size: 13px;padding: 14px 0px 0px 17px;color: #888888FF;width: 30%">监理单位:</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t\t<div style="font-size: 13px;padding: 14px 10px 0px 10px;color: #262626FF;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">'+data[i].superviceUnitFullname+'</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t<div style="display: flex">\n' +
						'\t\t\t\t\t\t\t\t\t\t\t\t<div style="font-size: 13px;padding: 14px 0px 0px 25px;color: #888888FF">检查日期:</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t\t<div style="font-size: 13px;padding: 14px 0px 0px 4px;color: #262626FF">'+data[i].checkTime.substring(0,11)+'</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t\t<div style="font-size: 13px;padding: 14px 0px 0px 25px;color: #888888FF">逾期情况:</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t\t<div style="color: #888888FF;border: 1px solid '+fontColor+';margin-top: 13px;height: 21px;margin-left: 4px;"><span style="color: '+fontColor+'">'+dateStr+'</span></div>\n' +
						'\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
						'\t\t\t\t\t\t\t\t\t\t</div>\n' +
						'\t\t\t\t\t\t\t\t\t</div>\n' +
						'                <input id="sf_guid'+(i+1)+'" type="text" value="'+data[i].guid+'" style="display: none">\n' +
						'\t\t\t\t\t\t\t\t</div>'
			}
			if(data.length==0){
				var html2 = '<div style="padding: 40px; height: 80px;">\n' +
						'\t\t\t\t\t\t暂无数据\n' +
						'\t\t\t\t\t</div>'
				$('.rectification-form').html(html2)
			}else {
				$('.rectification-form').html(html)
			}
			$('#num2').text(data.length)

			for (let j = 0; j <data.length; j++) {
				var rate = rectificationRateArr[j]
				mui('#demo'+(j+1)+'').progressbar({progress:data[j].successCheckItem/data[j].questionCheckItem}).show();
			}
			// mui("#demo1").progressbar({progress:20}).show();
			// mui("#demo2").progressbar({progress:20}).show();
		}


		/**
		* 获得时间差,时间格式为 年-月-日 小时:分钟:秒 或者 年/月/日 小时：分钟：秒
		* 其中，年月日为全格式，例如 ： 2010-10-12 01:00:00
		* 返回精度为：秒，分，小时，天
		*/

		function GetDateDiff(startTime, endTime, diffType) {
			//将xxxx-xx-xx的时间格式，转换为 xxxx/xx/xx的格式
			startTime = startTime.replace(/\-/g, "/");
			endTime = endTime.replace(/\-/g, "/");

			//将计算间隔类性字符转换为小写
			diffType = diffType.toLowerCase();
			var sTime = new Date(startTime);      //开始时间
			var eTime = new Date(endTime);  //结束时间
			//作为除数的数字
			var divNum = 1;
			switch (diffType) {
				case "second":
					divNum = 1000;
					break;
				case "minute":
					divNum = 1000 * 60;
					break;
				case "hour":
					divNum = 1000 * 3600;
					break;
				case "day":
					divNum = 1000 * 3600 * 24;
					break;
				default:
					break;
			}
			return parseInt((eTime.getTime() - sTime.getTime()) / parseInt(divNum));
		}



		//获取当前时间
		function getNowFormatDate() {
			var date = new Date();
			var seperator1 = "-";
			var seperator2 = ":";
			var month = date.getMonth() + 1;
			var strDate = date.getDate();
			var hour = date.getHours()
			var m = date.getMinutes()
			var s = date.getSeconds()
			if (month >= 1 && month <= 9) {
				month = "0" + month;
			}
			if (strDate >= 0 && strDate <= 9) {
				strDate = "0" + strDate;
			}
			if (hour >= 0 && hour <= 9) {
				hour = "0" + hour;
			}
			if (m >= 0 && m <= 9) {
				m = "0" + m;
			}
			if (s >= 0 && s <= 9) {
				s = "0" + s;
			}

			var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
					+ " " + hour + seperator2 + m
					+ seperator2 + s;
			return currentdate;
		}


		//在父页面添加一个reload刷新事件

		window.addEventListener('refresh', function(e){//执行刷新
			location.reload();
		});


		//测试区


	</script>

</html> 