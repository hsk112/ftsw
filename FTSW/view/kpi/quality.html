<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport"
			content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>质安监管</title>
	</head>
	<link href="../../css/mui.min.css" rel="stylesheet" />
	<link rel="stylesheet" type="" href="../../css/mui.picker.min.css" />
	<link rel="stylesheet" type="text/css" href="../../css/mui.poppicker.css" />
	<link href="../../css/common.css"  rel="stylesheet" />
	<style type="text/css">
		.drainageNum {
			height: 126px;
			background-color: white;
			margin-bottom: 5px;
		}

		.drainageNum_h {
			display: flex;
			justify-content: space-between;
		}

		.drainageNum_hl {
			width: 112px;
			height: 17px;
			font-size: 18px;
			font-family: PingFang SC;
			font-weight: bold;
			color: #262626;
			line-height: 24px;
			margin-left: 19px;
			margin-top: 17.5px;
			white-space: nowrap;
		}

		.drainageNum_b {
			display: flex;
			justify-content: space-between;
		}

		.xqgwzl,
		.xqgwqs {
			width: 120px;
			height: 14px;
			font-size: 14px;
			font-family: PingFang SC;
			font-weight: bold;
			color: #7F7F7F;
			line-height: 24px;
			margin-left: 20px;
		}

		.xqgwzl_num,
		.xqgwqs_num {
			width: 13px;
			height: 18px;
			font-size: 24px;
			font-family: PingFang SC;
			font-weight: bold;
			color: #0493F3;
			line-height: 24px;
			margin-right: 30px;
		}

		.xq_suml,
		.xq_sumr {
			display: flex;
			justify-content: space-around;
			margin-top: 37px;
			/* background-color: yellow; */
		}

		#workFinish {
			height: 320px;
			background-color: white;
			margin-bottom: 5px;
		}
		.imgs {
			width: 9px;
			height: 7px;
			display: inline-block;
			float: right;
			margin-top: 4.5px;
		}
	</style>
	</head>
	<body>
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">

				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="mui-content" class="mui-page">
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<!-- 监督项目详情统计开始 -->
						<div class="drainageNum">

							<div class="drainageNum_h">
								<div class="drainageNum_hl"><span>监督项目详情统计</span></div>
							</div>

							<div class="drainageNum_b">
								<div class="xq_suml">
									<span class="xqgwzl">质安监督项目(个)</span>
									<span class="xqgwzl_num pipeLength">0</span>
								</div>
								<div class="xq_sumr">
									<span class="xqgwqs">参与监督人员(个)</span>
									<span class="xqgwqs_num objCount">0</span>
								</div>
							</div>

						</div>
						<!-- 监督项目详情统计结束 -->
						<!-- 质安监督检查工作开始 -->
						<div id="workFinish">
							<div class="drainageNum_h" style="margin-bottom: 10px;">
								<div class="drainageNum_hl"><span>质安监督检查工作统计</span></div>
								<div class="drainageNum_hr1" style="margin-top: 10px;"><button style="border: none;color:#0493F3;">
										<div class="drainageNum_hr"><span class="timeYears">2021</span><img
												src="../../img/arrowDownBlue.png" alt="" class="imgs" style="margin-left: 6px;"></div>
									</button></div>
							</div>
							<div id="main2" style="width: 100%;height:240px;"></div>
						</div>
						<!-- 质安监督检查工作结束 -->
					</div>
				</div>
			</div>
		</div>
		<!--单页面结束-->
	</body>
	<script src="../../js/kpi/drainage.js"></script>
	<script src="../../js/kpi/index.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.view.js"></script>
	<script src="../../js/config.js"></script>
	<script src="../../js/mui.zoom.js"></script>
	<script src="../../js/app.js"></script>
	<script src="../../js/common.js"></script>
	<script src="../../js/mui.picker.min.js"></script>
	<script src="../../js/mui.poppicker.js"></script>
	<script src="../../js/mui.locker.js"></script>
	<script src="../../js/echarts.min.js"></script>
	<script src="./echarts-module/flow-chart.js"></script>
	<script type="text/javascript">
		var url1 = config.urls.baseUrl + "ft-emergency/statistics/xzsp/qs/supervise_count"//监督详情统计
		var url2 = config.urls.baseUrl + "ft-emergency/statistics/xzsp/qs/check_count"//质安监督检查工作统计
		// 监督项目详情统计开始
		var parmas1 = {}
		getDrainage(url1, parmas1, function(data) {
			console.log(JSON.stringify(data))
			$(".objCount").text(data.result.personNum)
			$(".pipeLength").text(data.result.recordNum)
		})
		// 监督项目详情统计结束
		//质安监督检查工作统计开始
		var parmas2={
			year:"2021"
		}
		var m=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]
		var serveTBar = echarts.init(document.getElementById('main2'));
		getDrainage(url2, parmas2, function(data){
			console.log(JSON.stringify(data))
			serveTBar.setOption(getEcharts3DBar(m,data.result.countData, '01'));
		})
		
		$('.timeYears').on('tap', function() {
			//设置年份的选择
			var options = [];
			var myDate = new Date();
			var startYear = myDate.getFullYear() - 10; //起始年份
			var endYear = myDate.getFullYear(); //结束年份
			for (var i = startYear; i <= endYear; i++) {
				options.push({
					value: i,
					text: i
				})
			}
			var picker = new mui.PopPicker();
			picker.setData(options);
			picker.show(function(selectItems) {
				$(".timeYears").text(selectItems[0].text)
				CheckTypeIndex = selectItems[0].value
			})
		})
		
		$('.timeYears').on('DOMNodeInserted', function() {
			parmas2 = {
				year: $('.timeYears').text()
			};
			getDrainage(url2, parmas2, function(data){
				console.log(JSON.stringify(data))
				serveTBar.setOption(getEcharts3DBar(m,data.result.countData, '01'));
			})
			
			})
		//质安监督检查工作统计结束
		//立体柱状图
		function getEcharts3DBar (xAxisData, data, colorType) {
		    var colorArr = [];
		    if (colorType == '01') {
		        colorArr = ["#0493F3", "#50bfda", "#89e3ec"];
		    } else {
		        colorArr = ["#0493F3", "#50dac0", "#87e8c7"];
		    }
		    var color = {
		        type: "linear",
		        x: 0,
		        x2: 1,
		        y: 0,
		        y2: 0,
		        colorStops: [
		            {
		            offset: 0,
		            color: colorArr[0],
		            },
		            {
		            offset: 0.5,
		            color: colorArr[0],
		            },
		            {
		            offset: 0.5,
		            color: colorArr[1],
		            },
		            {
		            offset: 1,
		            color: colorArr[1],
		            },
		        ],
		    };
		    var barWidth = 30;
		    var constData = [];
		    var showData = [];
		    data.filter(function (item) {
		    if (item) {
		        constData.push(1);
		        showData.push(item);
		    } else {
		        constData.push(0);
		        showData.push(
		         {
		            value: 1,
		            itemStyle: {
		              normal: {
		                borderColor: "rgba(0,0,0,0)",
		                borderWidth: 2,
		                color: "rgba(0,0,0,0)",
		              },
		            },
		         }
		        );
		    }
		    });
		    return {
		        tooltip: {
		            trigger: "axis",
		            formatter: function (params) {
		            var str = params[0].axisValue + "：";
		            params.filter(function (item) {
		                if (item.componentSubType == "bar") {
		                str += "<br/>" + item.seriesName + "：" + item.value;
		                }
		            });
		            return str;
		            },
		        },
		        grid: {
		            left: "3%", //图表距边框的距离
		            right: "3%",
		            top: "25%",
		            bottom: "5%",
		            containLabel: true,
		        },
				title: {
					subtext: '人次'
				},
		        xAxis: {
		            data: xAxisData,
		            axisTick: {
		            show: false,
		            },
		        },
		        yAxis: {
					type: 'value'
		        },
		        series: [
		            {
			            z: 1,
			            name: '数据',
			            type: "bar",
			            barWidth: barWidth,
			            barGap: "0%",
			            data: data,
			            itemStyle: {
			                normal: {
			                color: color,
			                },
			            },
		            },
		            {
			            z: 2,
			            name: '数据',
			            type: "pictorialBar",
			            data: constData,
			            symbol: "diamond",
			            symbolOffset: ["0%", "50%"],
			            symbolSize: [barWidth, 10],
			            itemStyle: {
			                normal: {
			                color: color,
			                },
			            },
			            tooltip: {
			                show: false,
			            },
		            },
		            {
			            z: 3,
			            name: '数据',
			            type: "pictorialBar",
			            symbolPosition: "end",
			            data: showData,
			            symbol: "diamond",
			            symbolOffset: ["0%", "-50%"],
			            symbolSize: [barWidth - 4, (10 * (barWidth - 4)) / barWidth],
			            itemStyle: {
			                normal: {
			                borderColor: colorArr[2],
			                borderWidth: 2,
			                color: colorArr[2],
			                },
			            },
			            tooltip: {
			                show: false,
			            },
		            },
		        ],
		    };
		}
		
	</script>
</html>
