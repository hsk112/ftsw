<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/common.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.imageviewer.css" />
		<style>
			.mui-input-row {
				position: relative;
				float: left;
				width: 100%;
				text-align: left;
				clear: none;
			}

			.mui-checkbox input[type=checkbox]:before,
			.mui-radio input[type=radio]:before {
				font-size: 25px;
			}

			.mui-checkbox.mui-left label,
			.mui-radio.mui-left label {
				padding-left: 50px;
				font-size: 16px;
			}

			.info-bar-title {
				height: 40px;
				background: #f6f4f7;
				font-size: 15px;
				text-align: left;
				color: #8e8e8e;
				line-height: 40px;
				padding: 0 18px;
			}

			.info-bar-content {
				height: 470px;
			}

			.info-bar-content-item {
				height: 240px;
				margin: 0px 18px;
				/* border-bottom: 1px solid #eee; */
			}

			.info-bar-content-item .item-title {
				text-align: left;
				padding: 20px 0px 0px;
				font-size: 14px;
			}


			.bottom-btn {
				width: 100%;
			}

			/*
			.mui-scroll-wrapper {
			} */

			.object {
				display: flex;
				justify-content: space-between;
				margin: 8px 0;
				color: #444444;
			}

			.mui-checkbox.mui-left label {
				padding-left: 0;
			}

			.mui-backdrop {
				background: rgba(0, 0, 0, 0.1);
			}

			.img_item {
				float: left;
				text-align: left;
				width: 72px;
				height: 72px;
				margin-right: 20px;
			}

			.img_item::after {
				clear: both;
				content: '';
				display: block;
				width: 0;
				height: 0;
				visibility: hidden;
			}

			.img_item img {
				width: 72px;
				height: 72px;
			}


			.info-bar-content-item {
				border: 0;
			}

			

			.btn-item button {
				margin: 0;
				border: 1px solid #337BFC;
				height: 40px;
				border-radius: 50px;
			}

			.in-obj {
				color: #888;
				font-weight: 400;
			}

			.obj-title {
				font-weight: 400;
				color: #444444;
			}


			span[new] {
				display: inline-block;
				position: relative;
				left: -20px;
				top: 5px;
				width: 20px;
				height: 20px;
				border-radius: 50%;
				border: 1px solid #999;
				margin-right: -10px;
			}
		</style>
	</head>

	<body>
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="mui-content" class="mui-page">
			<!--页面标题栏开始-->
			<!-- <header class="mui-bar mui-bar-nav common-header">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
				<h1 class="mui-title">养护内容</h1>
				<div class="mui-pull-right header-btn">
					<img src="../img/commom/nfc@2x.png" />
					<img src="../img/commom/lixz@2x.png" />
				</div>
			</header> -->
			<!--页面标题栏结束-->
			<!--页面主内容区开始-->
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper" style="background: #FFFFFF;">
					<div class="mui-scroll">
						<div class="scroll-li">
							<div style="background: #F4F4F4;">
								<div class="mui-collapse-content li-item-pull" id="object">
									<div>
										<div id="objHeader" style="padding: 0 18px;background: #ffffff;border-bottom: 5px solid #F4F4F4;">
											<div class="object">
												<div><span class="in-obj">养护对象：</span><span class="obj-title" id="maintainObj">加载中</span></div>
												<div class="type-inspection"><img src="../../img/commom/ywc.png" alt=""></div>
											</div>
											<div class="object" style="text-align:left;">
												<div style="width:100%;">
													<span class="in-obj">养护内容：</span>
													<div class="obj-title" style="width:70%;word-break: break-all;display:inline-block;vertical-align:top;" id="maintContent">加载中</div>
												</div>
											</div>
											<div class="object" style="text-align:left;">
												<div style="width:100%;">
													<span class="in-obj">养护频次：</span>
													<div class="obj-title" style="width:70%;display:inline-block;vertical-align:top;" id="maintFrequency_dictText">加载中</div>
												</div>
											</div>
											<div class="object">
												<div>
													<span class="in-obj">截止日期：</span>
													<span class="obj-title" style="text-align:left;" id="endDate">加载中</span>
												</div>
											</div>

										</div>

									</div>

								</div>
							</div>

							<div id="inspectDetail" style="margin:0;">
								<div class="scroll-li">
									<div class="info-bar-content-item" style="width: 100%;text-align: left;margin-left:20px;height: 70px;">
										<div class="item-title in-obj" style="margin-bottom:10px;font-weight: 400;color: #444444;">
											现场照片
										</div>
										<input id="fileId" style="display: none;" />
										<div class="photo_list" id="photo_list">
											<div class="empty" id="empty">无</div>
											<!-- 底下已经控制数据 -->
											<!-- <div class="img_item" style="position: relative;">
												<img class="img_src" src="../../img/commom/pz@2x.png" style="" />
												<div class="img_close" style=""><span style="color:#888888;height: 8px;width: 8px;">x</span></div>
											</div> -->
										</div>
									<!-- 	<div id="photo" class="img_item">
											<img class="img_src" src="../../img/commom/pz@2x.png" style="" />
										</div> -->
									</div>
									<div class="info-bar-content-item">
										<div class="item-title" style="margin-bottom: 10.5px;">
											<span>备注</span>
										</div>
										<div class="mui-input-row item-input">
											<textarea id="remark" readonly="readonly" rows="3" style="height: 80px;" class="mui-input-clear inputCss"
											 placeholder="" maxlength="2000"></textarea>
										</div>
									</div>
								</div>

							</div>
						</div>
					</div>

				</div>


			</div>

			<!--页面主内容区结束-->
		</div>
		<div id="textFrame" class="scroll-li" style="display:none;width: 100%;height:100px;background: rgba(0,0,0,0.5);position: fixed;bottom: 0;z-index: 999;"></div>
		<div id="texthtml" class="scroll-li" style="width: 100%;background: #F4F4F4;position: fixed;bottom: 0;z-index: 99;">
			<div class="bottom-btn" style="background: #F4F4F4;width: 100%;padding: 20px 0;">
				<div class="btn-item" style="background: #F4F4F4;">
					<button id="back" name="back" style="background: #ffffff;color: #337BFC;width: 30%;margin-left: 0;display: inline-block;">返回列表</button>
					<button id="prev" name="prev" style="background: #337BFC;color: #fff;width: 25%;margin-left: 5%;display: inline-block;">上一个</button>
					<button id="next" name="next" style="background: #337BFC;color: #fff;width: 25%;margin-left: 5%;display: inline-block;">下一个</button>
				</div>
			</div>
		</div>

	</body>


	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.view.js"></script>
	<script src="../../js/mui.locker.js"></script>
	<script src="../../js/app.js"></script>
	<script src="../../js/common.js"></script>
	<script src="../../js/config.js"></script>
	<script src="../../js/maintain.js"></script>
	<script src="../../js/mixed.js"></script>
	<script src="../../js/uploadimage.js"></script>
	<script src="../../js/s4.js"></script>
	<script src="../../js/smutils.js"></script>
	<script src="../../js/byte&string.js"></script>
	<script src="../../js/ajaxhook.min.js"></script>
	<script src="../../js/mui.zoom.js"></script>
	<script src="../../js/mui.previewimage.js"></script>
	<script src="../../js/helper.js"></script>
	<script src="../../js/vconsole.min.js"></script>
	<script>
		// var vConsole = new VConsole();

		var i = 0;
		var contentList = [] //养护内容列表
		var currentContent = {} //当前的养护内容
		var maintainObj = ""; //养护对象
		var endTime = "";
		var self;



		mui.init({
			beforeback: function() {
				var list = plus.webview.currentWebview().opener();
				//refresh是A页面自定义事件
				mui.fire(list, 'aaa');
				mui.fire(list, 'backInspection');
				mui.fire(list, 'toInfo');
				//返回true,继续页面关闭逻辑
				return true;
			}
		});
		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#mui-content'
		});
		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();
		mui.plusReady(function() {
			var self = plus.webview.currentWebview();
			maintainObj = self.maintainObj;
			contentList = self.contentList; //获取养护内容列表
			endTime = self.endTime;
			currentContent = self.currentContent;
			if (currentContent == undefined) {
				currentContent = contentList[i]
			}
			// console.log(JSON.stringify(contentList))
			self.setStyle({
				titleNView: {
					titleText: self.workPackageName,
				}
			});

			if(contentList.length<=1){
				$("#next").attr({"disabled":"disabled"})
				$("#prev").attr({"disabled":"disabled"})
			}else if(contentList.length>1){				
				$("#prev").attr({"disabled":"disabled"})
			}
			// console.log("当前养护内容：" + JSON.stringify(currentContent.maintFrequency))
			$("#maintainObj").html(isEmp(currentContent.maintainObj));
			$("#maintContent").html(isEmp(currentContent.maintainContent))
			getDicText(currentContent.maintFrequency,'ZHSW.INSPECT.TASK_FREQUENCY',function(data){	
				$('#maintFrequency_dictText').text(isEmp(data));
			})	
			$("#endDate").html(endTime != "" ? endTime : (new Date()).Format("yyyy-MM-dd"))
			$("#remark").val(isEmp(currentContent.remark));
			//照片
			if(currentContent.attachment!=null&&currentContent.attachment!=undefined){
				findFilesByGroupId({
					groupId: currentContent.attachment
				}, function(data) {
					if (data.success) {
						// console.log(JSON.stringify(data))
						 if(data.result && data.result.length>0) {
							var str = config.urls.baseUrl + 'sys/common/view/' + data.result[0].uploadFile.savePath;
							var html= '<div id="' + data.result[0].uploadFile.id + '" data-token="' + data.result[0].fileToken +
								'" name="" class="img_item" style="position:relative;">' +
								'		<img class="img_src" src="' + str +
								'" style="" data-preview-src="" data-preview-group="1" />' +
								'	</div>';
							$("#photo_list").parent().css("height","120px");
							$("#photo_list").html(html);
						}
					}
				});
			}
			
		});
		//图片预览
		$(document).on('tap', '.img_src', function() {
			mui.previewImage();
		});

		$("#next").on('tap', function() {
			i++;
			refreshData()
		})
		$("#prev").on('tap', function() {
			i--;
			refreshData()
		})
		$("#back").on('tap', function() {
			var view = plus.webview.getWebviewById("view/maintenance/maintain_index.html");
			console.log(view)
			mui.fire(view, 'backInspection');
			plus.webview.currentWebview().close('none'); //关闭

			return;
		})

		function refreshData() { //监听返回
			currentContent=contentList[i];
			app.showLoader();
			setTimeout(function() {
				app.hideLoader()
				console.log(i)
				console.log(contentList.length-1)
				if(i>=contentList.length-1){						
					$("#prev").removeAttr("disabled");
					$("#next").attr({"disabled":"disabled"})
				}else if(i==0){
					$("#next").removeAttr("disabled");
					$("#prev").attr({"disabled":"disabled"})
				}else{
					$("#next").removeAttr("disabled");
					$("#prev").removeAttr("disabled");
				}
				app.toast("跳转成功！");	
			}, 500)
			
			$("#maintainObj").html(isEmp(currentContent.maintainObj)+i);
			$("#maintContent").html(isEmp(currentContent.maintainContent))
			getDicText(currentContent.maintFrequency,'ZHSW.INSPECT.TASK_FREQUENCY',function(data){	
				$('#maintFrequency_dictText').text(isEmp(data));
			})	
			$("#endDate").html(endTime != "" ? endTime : (new Date()).Format("yyyy-MM-dd"))
			$("#remark").val(isEmp(currentContent.remark));

			//图片也要变
            if(currentContent.attachment!=null&&currentContent.attachment!=undefined){
                findFilesByGroupId({
                    groupId: currentContent.attachment
                }, function(data) {
                    if (data.success) {
                        if(data.result && data.result.length>0) {
                            var str = config.urls.baseUrl + 'sys/common/view/' + data.result[0].uploadFile.savePath;
                            var html= '<div id="' + data.result[0].uploadFile.id + '" data-token="' + data.result[0].fileToken +
                                '" name="" class="img_item" style="position:relative;">' +
                                '		<img class="img_src" src="' + str +
                                '" style="" data-preview-src="" data-preview-group="1" />' +
                                '	</div>';
                            $("#photo_list").parent().css("height","120px");
                            $("#photo_list").html(html);
                        }
                    }
                });
            }
		};
	</script>

</html>
