<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>排水户-信息</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" type="text/css" href="../../css/mui.imageviewer.css" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<link href="../../css/common.css" rel="stylesheet" />
		<style>
			.mui-popover {
				height: 300px;
			}
			.img_item{
				text-align: left;
				width: 72px;
				height: 100px;
				float: left;
				margin-right: 20px;
			}
			.img_item img{
				width: 72px;
				height: 72px;
			}
			.options-box {
				position: absolute;
				top: 0;
				z-index: 10;
				display: flex;
				padding: 1rem 1rem 1.5rem;
				width: 100%;
				height: 10vh;
				background-color: #fff;
			}
			.options-box span{
				font-size: 14px;
				color: #999;
			}
			.options-box .active {
				color: #337BFC;
				font-size: 16px;
			}
			.options {
				flex: 1;
				text-align: center;
			}
			.content-box {
				position: relative;
				margin-top: 10vh;
				height: 90vh;
			}
		</style>
	</head>

	<body>
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="mui-content" class="mui-page paish">
			<!--页面标题栏开始-->
			<!-- <header class="mui-bar mui-bar-nav common-header">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
				<h1 class="mui-title">排水户登记</h1>
			</header> -->
			<!--页面标题栏结束-->
			<!--页面主内容区开始-->
			<div class="mui-page-content">
				<div class="options-box">
					<span id="showOne" class="options">基本信息</span>
					<span>|</span>
					<span id="showSec" class="options active">证照信息</span>
					<span>|</span>
					<span id="showThe" class="options">排口信息</span>
					<span>|</span>
					<span id="showFou" class="options">扩展信息</span>
				</div>
				<div class="content-box">
					<div class="mui-scroll-wrapper" id="wrapper">
						<div class="mui-scroll" id="content">
							<div class="scroll-li" id="scroll-li">
								<div class="bar-title">
									证照情况
								</div>
								<div class="info-bar-content">
									<div class="info-bar-content-item">
										<div class="item-title">
											是否需办营业执照
										</div>
										<div class="item-checkbox">
											<div class="mui-input-row mui-checkbox mui-left">
												<label>是</label>
												<input name="hasDiscCode" value="1" type="checkbox" disabled="true">
											</div>
											<div class="mui-input-row mui-checkbox mui-left">
												<label>否</label>
												<input name="hasDiscCode" value="0" type="checkbox" disabled="true" checked>
											</div>
										</div>
									</div>
									<div id="for_hasDiscCode" class="info-bar-content-item" style="display: none;">
										<div class="item-title">
											是否取得营业执照
										</div>
										<div class="item-checkbox">
											<div class="mui-input-row mui-checkbox mui-left">
												<label>是</label>
												<input name="input_discCode" value="1" type="checkbox" disabled="true">
											</div>
											<div class="mui-input-row mui-checkbox mui-left">
												<label>否</label>
												<input name="input_discCode" value="0" type="checkbox" disabled="true" checked>
											</div>
										</div>
									</div>

									<div id="for_input_discCode" style="display: none;">
										<div class="info-bar-content-item">
											<div class="item-title">
												营业执照照片
												<!-- <a style="float: right;font-size: 14px;color: #337BFC;" href="#photoNotice">拍照须知</a> -->
											</div>
											<div class="dis_img_list" style="margin-top: 10px;">
												<div style="text-align: left;">无</div>
											</div>
											<!-- <div id="discCodeAttachment_img">
												<img id='discCodeAttachment' data-token='' style="width: 72px;height: 72px;float: left;" src="../../img/commom/pz@2x.png" />
											</div> -->
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												营业执照统一社会信用代码
											</div>
											<div class="mui-input-row item-input">
												<input id="discCode" type="text" readonly >
											</div>
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												营业执照核发日期
											</div>
											<div class="mui-input-row item-input">
												<input id="discDate" type="text" readonly>
											</div>
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												营业执照有效期
											</div>
											<div class="mui-input-row item-input">
												<input id="discExpired" type="text" readonly>
											</div>
										</div>
									</div>

									<div class="info-bar-content-item">
										<div class="item-title">
											是否需办排水许可证
										</div>
										<div class="item-checkbox">
											<div class="mui-input-row mui-checkbox mui-left">
												<label>是</label>
												<input name="hasPslCode" value="1" type="checkbox" disabled="true">
											</div>
											<div class="mui-input-row mui-checkbox mui-left">
												<label>否</label>
												<input name="hasPslCode" value="0" type="checkbox" disabled="true" checked>
											</div>
										</div>
									</div>

									<div id="for_hasPslCode" class="info-bar-content-item" style="display: none;">
										<div class="item-title">
											是否取得排水许可证
										</div>
										<div class="item-checkbox">
											<div class="mui-input-row mui-checkbox mui-left">
												<label>是</label>
												<input name="input_hasPslCode" value="1" type="checkbox" disabled="true">
											</div>
											<div class="mui-input-row mui-checkbox mui-left">
												<label>否</label>
												<input name="input_hasPslCode" value="0" type="checkbox" disabled="true" checked>
											</div>
										</div>
									</div>
									<div id="for_input_hasPslCode" style="display: none;">
										<div class="info-bar-content-item">
											<div class="item-title">
												排水许可证照片
												<!-- <a style="float: right;font-size: 14px;color: #337BFC;" href="#photoNotice">拍照须知</a> -->
											</div>
											<div class="psl_img_list" style="margin-top: 10px;">
												<div style="text-align: left;">无</div>
											</div>
											<!-- <div id="pslCodeAttachment_img">
												<img id="pslCodeAttachment" data-token='' style="width: 72px;height: 72px;float: left;" src="../../img/commom/pz@2x.png" />
											</div> -->
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												排水许可证编号
											</div>
											<div class="mui-input-row item-input">
												<input id="pslCode" type="text" readonly>
											</div>
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												排水许可证核发日期
											</div>
											<div class="mui-input-row item-input">
												<input id="pslBeginDate" type="text" readonly>
											</div>
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												排水许可证有效期
											</div>
											<div class="mui-input-row item-input">
												<input id="pslEndDate" type="text" readonly>
											</div>
										</div>
									</div>

									<div class="info-bar-content-item">
										<div class="item-title">
											是否需要排污许可证
										</div>
										<div class="item-checkbox">
											<div class="mui-input-row mui-checkbox mui-left">
												<label>是</label>
												<input name="hasEslCode" value="1" type="checkbox" disabled="true">
											</div>
											<div class="mui-input-row mui-checkbox mui-left">
												<label>否</label>
												<input name="hasEslCode" value="0" type="checkbox" disabled="true" checked>
											</div>
										</div>
									</div>
									<div id="for_hasEslCode" class="info-bar-content-item" style="display: none;">
										<div class="item-title">
											是否取得排污许可证
										</div>
										<div class="item-checkbox">
											<div class="mui-input-row mui-checkbox mui-left">
												<label>是</label>
												<input name="input_hasEslCode" value="1" type="checkbox" disabled="true">
											</div>
											<div class="mui-input-row mui-checkbox mui-left">
												<label>否</label>
												<input name="input_hasEslCode" value="0" type="checkbox" disabled="true" checked>
											</div>
										</div>
									</div>

									<div id="for_input_hasEslCode" style="display: none;">
										<div id="permit-photo3" class="info-bar-content-item" >
											<div class="item-title">
												排污许可证照片
												<!-- <a style="float: right;font-size: 14px;color: #337BFC;" href="#photoNotice">拍照须知</a> -->
											</div>
											<div class="esl_img_list" style="margin-top: 10px;">
												<div style="text-align: left;">无</div>
											</div>
											<!-- <div id="eslCodeAttachment_img">
												<img id="eslCodeAttachment" data-token='' style="width: 72px;height: 72px;float: left;" src="../../img/commom/pz@2x.png" />
											</div> -->
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												排污许可证编号
											</div>
											<div class="mui-input-row item-input">
												<input id="eslCode" type="text" readonly>
											</div>
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												排污许可证核发日期
											</div>
											<div class="mui-input-row item-input">
												<input id="eslBeginDate" type="text" readonly>
											</div>
										</div>
										<div class="info-bar-content-item">
											<div class="item-title">
												排污许可证有效期
											</div>
											<div class="mui-input-row item-input">
												<input id="eslEndDate" type="text" readonly>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="bottom-btn">
								<!--<div class="btn-item" id="psh_update">-->
								<div class="btn-item" id="back">
									<div style="color: #337BFC;">返 回</div>
								</div>
								<div class="btn-item" id="psh_add">
									<div style="background: #337BFC;color: #fff;">新增排水户</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--页面主内容区结束-->
		</div>

		<!--拍照须知-->
		<div id="photoNotice" class="mui-popover" style="text-align: left;background: #FFFFFF;">
			<div class="mui-popover-arrow"></div>
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view" style="background: #FFFFFF;">
						<li class="mui-table-view-cell"><a href="#">拍照须知:</a>
						</li>
						<li class="mui-table-view-cell"><a href="#" style="white-space:initial">拍照时应将证件摆放端正，拍摄照片应内容完整、字迹清晰。</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</body>

	<script type="text/javascript" src="http://gd.wiseom.cn/supermap/mapbox-gl-enhance.js"></script>
	<script type="text/javascript" src="http://gd.wiseom.cn/supermap/iclient-mapboxgl.min.js"></script>
	<script src="http://gd.wiseom.cn/mobile-lib/mobile-lib.umd.js"></script>

	<script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.view.js"></script>
	<script src="../../js/mui.locker.js"></script>
	<script src="../../js/mui.picker.min.js"></script>
	<script src="../../js/mui.poppicker.js"></script>

	<script src="../../js/app.js"></script>
	<script src="../../js/config.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/common.js"></script>	
	<script src="../../js/paishuihu.js"></script>
	<script src="../../js/helper.js"></script>
	<script src="../../js/uploadimage.js"></script>
	<script src="../../js/s4.js"></script>
	<script src="../../js/smutils.js"></script>
	<script src="../../js/byte&string.js"></script>
	<script src="../../js/ajaxhook.min.js"></script>
	<script src="../../js/mui.zoom.js"></script>
	<script src="../../js/mui.previewimage.js"></script>
	<script>
		var self;

		mui.init({swipeBack:false});
		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#mui-content'
		});

		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();

		mui.plusReady(function() {
			self = plus.webview.currentWebview();
			var winHeight = window.screen.height;
			$("#scroll-li").css('min-height',winHeight-240)
			// 页面选择
			initPageSelect();

			// 赋值
			initData();
		});

		// 页面选择
		var initPageSelect = function() {
			$("#psh_update").on("tap", function() {
				// app.openPage("paish_stepOne.html", {
				// 	titleNView: {
				// 		titleText: '排水户登记',
				// 		autoBackButton: true,
				// 	}
				// }, { returnUrl: 'paish_showSec.html' ,type : 'edit' });
				globalSetItem(GlobalKey.psh, JSON.stringify(self.data));
				globalSetItem(GlobalKey.isSelectPsh, "true");
				// console.log(JSON.stringify(globalGetItem(GlobalKey.psh)))
				app.openPage("paish_viewAddress.html", {
					titleNView: {
						titleText: '门牌地址',
						autoBackButton: true,
					}
				}, { returnUrl: 'paish_showOne.html' ,type : 'edit'});
			});

			$("#psh_add").on("tap", function() {
				globalSetItem(GlobalKey.psh, JSON.stringify(self.data));
				globalSetItem(GlobalKey.isSelectPsh, "true");
				app.openPage("addPaishuihu.html", {
					titleNView: {
						titleText: '新增排水户',
						autoBackButton: true,
					}
				}, { returnUrl: 'paish_showSec.html' ,type : 'add'});
			});

			$("#showOne").on("tap", function() {
				app.openPage("paish_showOne.html", {
					titleNView: {
						titleText: '查看排水户',
						autoBackButton: true,
					}
				}, { data: self.data, returnUrl: self.returnUrl });
			});

			$("#showThe").on("tap", function() {
				app.openPage("paish_showThe.html", {
					titleNView: {
						titleText: '查看排水户',
						autoBackButton: true,
					}
				}, { data: self.data, returnUrl: self.returnUrl });
			});
		}



		// 赋值
		var initData = function () {
			if(self.data.hasDiscCode == '1') {
				$("#for_hasDiscCode").show();
				$("input[name='hasDiscCode'][value=1]").prop("checked", true);
				$("input[name='hasDiscCode'][value=0]").prop("checked", false);
				if(self.data.discCode || self.data.discCodeAttachment) {
					$("#for_input_discCode").show();
					if(self.data.discCode) {
						$("input[name='input_discCode'][value=1]").prop("checked", true);
						$("input[name='input_discCode'][value=0]").prop("checked", false);
						$("#discCode").val(self.data.discCode);
						$("#discDate").val(self.data.discDate);
						$("#discExpired").val(self.data.discExpired);
					} else {
						$("input[name='input_discCode'][value=1]").prop("checked", false);
						$("input[name='input_discCode'][value=0]").prop("checked", true);
					}
					if (self.data.discCodeAttachment) {
						queryPhoto(self.data.discCodeAttachment, function (data) {
							if (data.result && data.result.length) {
								let path = data.result[0].uploadFile.savePath;
								let url = config.urls.baseUrl + 'sys/common/view/' + path;
								var html = '<div class="img_item">' +
										'		<img class="img_src imgCss" data-preview-src="" data-preview-group="1" src="' + url + '"/>' +
										'	</div>';
								$(".dis_img_list").html(html);
								$(".dis_img_list").parent().css("height","140px")
								$("#discCodeAttachment_img").hide();
							}
						})
					}
				}
			} else {
				$("#for_hasDiscCode").hide();
				$("#for_input_discCode").hide();
				$("input[name='hasDiscCode'][value=1]").prop("checked", false);
				$("input[name='hasDiscCode'][value=0]").prop("checked", true);
			}
			if(self.data.hasPslCode == '1') {
				$("#for_hasPslCode").show();
				$("input[name='hasPslCode'][value=1]").prop("checked", true);
				$("input[name='hasPslCode'][value=0]").prop("checked", false);
				if(self.data.pslCode || self.data.pslCodeAttachment) {
					$("#for_input_hasPslCode").show();
					if(self.data.pslCode) {
						$("input[name='input_hasPslCode'][value=1]").prop("checked", true);
						$("input[name='input_hasPslCode'][value=0]").prop("checked", false);
						$("#pslCode").val(self.data.pslCode);
						$("#pslBeginDate").val(self.data.pslBeginDate);
						$("#pslEndDate").val(self.data.pslEndDate);
					} else {
						$("input[name='input_hasPslCode'][value=1]").prop("checked", false);
						$("input[name='input_hasPslCode'][value=0]").prop("checked", true);
					}
					if (self.data.pslCodeAttachment) {
						queryPhoto(self.data.pslCodeAttachment, function (data) {
							if (data.result && data.result.length) {
								let path = data.result[0].uploadFile.savePath;
								let url = config.urls.baseUrl + 'sys/common/view/' + path;
								var html = '<div class="img_item">' +
										'		<img class="img_src imgCss" data-preview-src="" data-preview-group="1" src="' + url + '" style=""/>' +
										'	</div>';
								$(".psl_img_list").html(html);
								$(".psl_img_list").parent().css("height","140px")
								$("#pslCodeAttachment_img").hide();
							}
						})
					}
				}
			} else {
				$("#for_hasPslCode").hide();
				$("#for_input_hasPslCode").hide();
				$("input[name='hasPslCode'][value=1]").prop("checked", false);
				$("input[name='hasPslCode'][value=0]").prop("checked", true);
			}
			if(self.data.hasEslCode == '1') {
				$("#for_hasEslCode").show();
				$("input[name='hasEslCode'][value=1]").prop("checked", true);
				$("input[name='hasEslCode'][value=0]").prop("checked", false);
				if(self.data.eslCode || self.data.eslCodeAttachment) {
					$("#for_input_hasEslCode").show();
					if(self.data.eslCode) {
						$("input[name='input_hasEslCode'][value=1]").prop("checked", true);
						$("input[name='input_hasEslCode'][value=0]").prop("checked", false);
						$("#eslCode").val(self.data.eslCode);
						$("#eslBeginDate").val(self.data.eslBeginDate);
						$("#eslEndDate").val(self.data.eslEndDate);
					} else {
						$("input[name='input_hasEslCode'][value=1]").prop("checked", false);
						$("input[name='input_hasEslCode'][value=0]").prop("checked", true);
					}
					if (self.data.eslCodeAttachment) {
						queryPhoto(self.data.eslCodeAttachment, function (data) {
							if (data.result && data.result.length) {
								let path = data.result[0].uploadFile.savePath;
								let url = config.urls.baseUrl + 'sys/common/view/' + path;
								var html = '<div class="img_item">' +
										'		<img class="img_src imgCss" data-preview-src="" data-preview-group="1" src="' + url + '" style=""/>' +
										'	</div>';
								$(".esl_img_list").html(html);
								$(".esl_img_list").parent().css("height","140px")
								$("#eslCodeAttachment_img").hide();
							}
						})
					}
				}
			} else {
				$("#for_hasEslCode").hide();
				$("#for_input_hasEslCode").hide();
				$("input[name='hasEslCode'][value=1]").prop("checked", false);
				$("input[name='hasEslCode'][value=0]").prop("checked", true);
			}
		}

		mui.back = function () {
			let url = self.returnUrl;
			popToTarget(url);
		}
		
		mui(".dis_img_list,.psl_img_list,.esl_img_list").on('tap', '.imgCss', function() {
			// $('#bottom-item-btn').hide();
			mui.previewImage();
		});
		
		window.addEventListener('backShowInfo', function(e) { //执行刷新
			// location.reload();
			
			queryByGuid(self.data.guid, function(data){				
				if (data.success && data.result!=null){		
					console.log(2222222)
					globalSetItem(GlobalKey.address, data.result.address );
										
					var point = {
						'lng':data.result.longitude,
						'lat':data.result.latitude
					}
					
					self.data = data.result;
					globalSetItem(GlobalKey.point, JSON.stringify(point));//选中地图点
					globalSetItem(GlobalKey.isSelectPsh, "true");//是否设置排水户
					globalSetItem(GlobalKey.psh, JSON.stringify(data.result));//保存选中的排水户
					globalSetItem(GlobalKey.id, self.data.guid);//选中排水户的id
					
					initPageSelect();
					
					// 赋值
					initData();
				
					mui('#wrapper').scroll().scrollTo(0,0,100);
				} else {
					clearGlobalItem();
					globalSetItem(GlobalKey.isSelectPsh, "false");//是否设置排水户					
				}
				
			});
		});
        $("#back").on('tap',function(){
            let url = self.returnUrl;
            popToTarget(url);
        })
	</script>
</html>
