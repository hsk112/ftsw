<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
		<title>质安监管-新增检查记录</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link href="../../../css/mui.min.css" rel="stylesheet" />
		<link href="../../../css/common.css" rel="stylesheet" /> 
        <link href="../../../css/mui.picker.min.css" rel="stylesheet" />    
		<link href="../../../css/mui.poppicker.css" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="../../../css/mui.imageviewer.css" />
        <style>
            .mui-page-content{
                padding-top:44px !important;
            }
            .recordInp::placeholder{
                text-align: right;
            }
            .recordInp{
                text-align: right;
                padding:10px 0 10px 15px !important;
            }
            .record-list{
               padding:0 20px 0 20px;
            }
            .lable{
                position: relative;
                text-align: left;
                padding:11px 0 11px 8px !important;
                height: 55px;
            }
            .lable span{
                position: absolute;
                top:15px;
                left:0px;
                color: #DB2828;
            }
            .date-item{
                position: relative;
            }
            .date-select{
                position: absolute;
                right: 0px;
                top:10px;
                font-size:16px;
            }
            .dateSelect{
                text-align: left !important;;
                width: 120px !important;
                font-size:  16px !important; ;
            }
            .dateSelect::placeholder{
                text-align: left;
                font-size: 16px;
            }
            .dateSelect-fill{
                text-align: left !important;;
                width: 120px !important;
                font-size:  16px !important; ;
            }
            .dateSelect-fill::placeholder{
                text-align: left;
                font-size: 16px;
            }
            .day-record{
                position: relative;
            }
            .dayRecord{
                position: absolute;
                right: 0px;
                top:10px;
            }
            .dayRecord span{
                font-size: 16px;
                color: #C5C5C5;
            }
            /* ------------- */
            .issues-total{
                display: flex;
                justify-content: space-between;
                padding:0 16px;
                height: 55px;
                line-height: 55px;
                font-size: 14px;
            }
            .total{
                color:#0493F3;
            }
            .mui-icon-bars{
                font-size: 14px;
                color:#0493F3;
            } 
            .bar{
                font-size: 18px;
                color:#0493F3;
            }  
            /* ------------*/
            
            .issues-list-item{
                padding:10px;
                text-align: left;
                background: #f4f4f4;
            }
            .issues-item-probably{
                font-size: 14px;
                padding-left: 20px;
                padding-right: 27px;
                padding-bottom: 20px;
                padding-top:1px;
                background: #fff;
                border-radius: 5px;
            }
            .item-list{
                margin-top:20px;
                display: flex;
                
            }
            .text-ellipsis{
                overflow: hidden;
                white-space:nowrap;
                text-overflow: ellipsis;
            }
            .fixed{
                color:#8C8C8C;
                display: inline-block;
                white-space:nowrap;
                margin-right: 8px;
            }
            .dynamic{
                color:#444444;
            }
            .pic{
                border-radius: 5px;
                display: flex;
                flex-direction:row;
                flex-wrap:wrap;
                overflow:hidden;
            }
            .quesList_img>img{
                width: 72px;
                height: 72px;
                border-radius: 5px;
                margin-right: 2px;
                margin-bottom: 2px;
                
            }
            .setHeight{
                height: 72px;
            }
            .item-probably-bot{
                margin-top:20px;
                border-top: solid 0.5px #EDEDED;
                line-height: 44px;
                height: 44px;
                display: flex;
                justify-content: space-between;
            }
            .corner{
                font-size: 18px;
                color: #C5C5C5;
                line-height: 44px;
            }
            
            .cut{
                font-size: 14px;
                color: #444444;
            }
            
            .hidden{
                display: none;
            }
            .issues-list-item{
                background:#F4F4F4;
            }
            /* ----- */
            .page-middle .for_result{
                display: flex;
                height: 55px;
                align-items: center;
            }
            .page-middle .for_result .check-item {
                display: flex;
                justify-content: space-between;
            }
            .checkbox{
                display: flex !important;
                align-items: center !important;
                justify-content:flex-start !important;
            }
            .checkbox label{
                margin-left:  -28px !important;;
            }
            .checkbox input{
                margin-left:-20px;
            }
            .page-bottom{
                padding-left: 20px;
            }
            .remark-text{
                height: 55px;
                text-align: left ;
                line-height: 55px;
                border-top:solid 0.5px #EDEDED;
                border-bottom: solid 0.5px #EDEDED;
            }
            /* ---------- */
            .page-footer{
                padding:0 20px 0 20px;
            }
            .page-footer .f-item-list{
                height: 55px;
                line-height: 55px;
                display: flex;
                justify-content: space-between;
            }
            .page-footer .f-item-list input{
                border:none;
                text-align: right;
            }
            .page-footer .f-item-list input::placeholder{
                text-align: right;
                font-size: 16px;
            }
            .page-footer .dateS{
                display: flex;
                justify-content: flex-end;
                align-items: center;
                padding-right: 12px;
            }
            /* ------ */
            .footer-btn{
                height: 98px;
                background: #F4F4F4;
                line-height: 98px;
            }
            .footer-btn .btn-sub{
                width: 335px;
                height: 48px;
                background: #0493F3;
                color:#fff;
                font-size: 18px;
                text-align: center;
                border-radius: 4px;
                margin: 0 auto;
                vertical-align:middle;
                line-height: 48px;
                display: inline-block;
            }
            /*  */
            .file_upload{
                padding: 3px 0;
                width: 90px;
                background: #337BFC;
                border: 1px solid #337BFC;
                border-radius: 26px;
            }
            .btn-label{
                font-size: 12px;
                font-weight: 400;
                color: #B1B1B1;
                line-height: 14px;
            }
            .issues-item{
                margin-bottom: 20px;
            }
            .inputRow{
                border-bottom: 1px solid #EDEDED;
                
            }
            .lable{
                position: relative;
                top: 10px;
            }
            .recordInp{
                position: relative;
                top:10px;
            }
            .isWrap{
                word-wrap: break-word;
                word-break: break-all;
                overflow: hidden;
            }
            .actualCheckTime::placeholder{
                text-align: center;

            }
        </style>
</head>
<body>
    <!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
        <div id="mui-content" class="mui-page">
            <!--单页面标题开始-->
            <!-- <header class="mui-bar mui-bar-nav common-header">
                <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
                <h1 class="mui-title">新增问题</h1>
            </header> -->
            <!--页面标题栏结束-->
            <!-- 页面主要内容区开始 -->
            <div class="mui-page-content">
                <div class="mui-scroll-wrapper" style="overflow: scroll;">
                    <div class="mui-scroll">
                        <div class="record-list">
                            <div class="mui-input-row input-row-item inputRow">
                                <label class="lable"><span>*</span>工程名称</label>
                                <input type="text" class=" recordInp projectName" readonly="readonly"  placeholder="工程名称">
                            </div>                       
                            <div class="mui-input-row input-row-item inputRow">
                                <label class="lable">建设单位</label>
                                <input type="text" class=" recordInp constructionUnitName" readonly="readonly" placeholder="自动回填">
                            </div>
                            <div class="mui-input-row input-row-item inputRow">
                                <label class="lable">施工单位</label>
                                <input type="text" class=" recordInp engineerUnitName" readonly="readonly" placeholder="自动回填">
                            </div>
                            <div class="mui-input-row input-row-item inputRow">
                                <label class="lable"><span>*</span>监督内容</label>
                                <input type="text" class=" recordInp supervisorUnitName"  placeholder="请输入监督内容">
                            </div>
                            <div class="mui-input-row input-row-item record-type day-record inputRow">
                                <label class="lable"><span>*</span>检查类型</label>
                                
                                    <input type="text" class=" recordInp dailyCheckTypeStr" readonly="readonly" placeholder="请选择检查类型">
                                    <!-- <span class="mui-icon mui-icon-arrowright"></span> -->
                                
                                
                                <!-- <span class="dailyCheckTypeStr" style="color: #000;">日常检查</span> -->
                            </div>
                            <div class="mui-input-row input-row-item date-item inputRow">
                                <label class="lable"><span>*</span>实际检查日期</label>
                                <input type="text" readonly="readonly" class=" recordInp dateSelect actualCheckTime" placeholder="请选择" style="text-align: right;"/>
                                <span class="date-sideslip"><img src="../../../img/cal.png" style="width:16px;height:16px;position: absolute;right: 0px;top:22px;" alt=""></span>
                            </div>
                            <div class="mui-input-row input-row-item inputRow">
                                <label class="lable"><span>*</span>检查人</label>
                                <input type="text" class=" recordInp dailyCheckPersonRealname" placeholder="请选择检查人" readonly="readonly">
                            </div>
                            <div class="mui-input-row input-row-item inputRow">
                                <label class="lable">随检人员</label>
                                <input type="text" class=" recordInp followCheckPerson"  placeholder="请填写跟随人员名称">
                            </div>
                        </div>
                        
                        <div class="issues-total">
                            <div class="issues-total-left">
                                <img src="../../../img/fujin-icon.png"
                       style="width: 13px;height: 14px;line-height: 14px;vertical-align:middle;margin-top: -2px"/>
                                <span class="issues-text">问题清单</span>:
                                <span class="total">0</span>
                            </div>  
                            <div class="issues-total-right">
                                <span class="mui-icon mui-icon-arrowdown top-bar hidden bar"></span>
                                <span class="mui-icon mui-icon-arrowup bottom-bar  bar"></span>
                            </div>
                        </div>
                        <div class="issues-list-item hidden">
                            <!-- <div class="issues-item">
                                <div class="issues-item-probably">
                                    <div class="item-list ">
                                        <span class="fixed">问题类型:</span>
                                        <span class="dynamic">地基与基础</span>
                                    </div>
                                    <div class="item-list ">
                                        <span class="fixed">检查结果:</span>
                                        <span class="dynamic text-ellipsis">安全管理制度、操不完善操作规程不完善操作规程不完善操作规程不完善</span>
                                    </div>
                                    <div class="item-list ">
                                        <span class="fixed">整改要求:</span>
                                        <span class="dynamic text-ellipsis">这里是一段很长的整改要求， 这里是2111111111的is阿杰科技</span>
                                    </div>
                                    <div class="item-list">
                                        <span class="fixed">相关图片:</span>
                                        <div class="pic dynamic clearfix">
                                            <img src="http://img.hc360.com/shoes/info/images/200812/200812100834368125.jpg" alt="">
                                            <img src="http://img.hc360.com/shoes/info/images/200812/200812100834368125.jpg" alt="">
                                            <img src="http://img.hc360.com/shoes/info/images/200812/200812100834368125.jpg" alt="">
                                        </div>
                                    </div>
                                    <div class="item-probably-bot">
                                        <span class="cut cut1 ">详情</span>
                                        <span class="cut cut2 hidden">收起</span>
                                        <span  class="mui-icon mui-icon-arrowdown corner corner1"></span>
                                        <span  class="mui-icon mui-icon-arrowup hidden corner corner2"></span>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                        <div class="page-middle">
                            <div class="for_result">
                                <div class="item-titlt" style="width:25%;white-space:nowrap;text-align: left;padding-left:20px ;">
                                    检查结果
                                </div>
                                <div class="check-item">
                                    <div class="mui-input-row inputRow mui-checkbox mui-left checkbox" style="width:80px;white-space:nowrap;">
                                        <label>纠正</label>
                                        <input class="checkboxI" name="input_hasEslCode" required="true" placeholder="123" value="1" type="checkbox" >
                                    </div>
                                    <div class="mui-input-row inputRow mui-checkbox mui-left checkbox" style="width:80px;white-space:nowrap;">
                                        <label>整改</label>
                                        <input class="checkboxI" name="input_hasEslCode" required="true" placeholder="123" value="2" type="checkbox">
                                    </div>
                                    <div class="mui-input-row inputRow mui-checkbox mui-left checkbox" style="width:100px;white-space:nowrap;">
                                        <label>停工整改</label>
                                        <input class="checkboxI" name="input_hasEslCode" required="true" placeholder="123" value="3" type="checkbox" >
                                    </div>
                                </div>
                            </div>
                            <div class="page-bottom">
                                <div class="remark-text">
                                    备注
                                </div>
                                <textarea type='text' name="remark" id="remark"  placeholder="请输入相关描述(300以内)" style="min-height:144px;width:100%;border:none"></textarea>
                                <!-- <div class="remark-text">
                                    通知书
                                </div>
                                <div id="file3" class="file_item" style="text-align: left;">
                                    <button type="button" name="file" id="upload_file" class="file_upload mui-btn mui-btn-primary">上传文件</button>
                                    <span class="btn-label">只能上传.doc .docx .pdf文件!</span>
                                </div> -->
                            </div>
                            <div class="page-footer">
                                <div class="mui-input-row inputRow input-row-item">
                                    <label class="lable">填写人</label>
                                    <input type="text" class=" recordInp realname" readonly="readonly" >
                                </div>
                                <div class="mui-input-row inputRow input-row-item">
                                    <label class="lable">填写部门</label>
                                    <input type="text" class=" recordInp inputDepartmenFullname" readonly="readonly" >
                                </div>
                                <div class="mui-input-row inputRow input-row-item">
                                    <label class="lable">联系方式</label>
                                    <input type="text" class=" recordInp mobilePhone" readonly="readonly" >
                                </div>
                                <div class="mui-input-row inputRow input-row-item date-item">
                                    <label class="lable" >填写日期</label>
                                    
                                        <input type="text"  class=" recordInp  dateSelect-fill inputDate" readonly="readonly" />
                                        <span class="date-fill"><img src="../../../img/cal.png" style="width:16px;height:16px;position: absolute;right: 0px;top:22px;" alt=""></span>
                                    
                                </div>                                
                            </div>

                        </div>
                        <div class="footer-btn">
                            <div class="btn-sub">提交</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</body>

    <script src="../../../js/mui.min.js"></script>
	<script src="../../../js/mui.view.js"></script>
	<script src="../../../js/mui.locker.js"></script>
	<script src="../../../js/mui.picker.min.js"></script>
	<script src="../../../js/mui.poppicker.js"></script>

	<script src="../../../js/config.js"></script>
	<script src="../../../js/common.js"></script>
	<script src="../../../js/app.js"></script>
	<script src="../../../js/jquery.min.js"></script>
    <script src="../../../js/qualityControl/qualityControl.js"></script>
    <script src="../../../js/mui.zoom.js"></script>
    <script src="../../../js/mui.previewimage.js"></script>
    <script src="../../../js/vconsole.min.js"></script>
<script>
    // var vConsole = new VConsole();
    mui.init({});
		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#mui-content'
		});
		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();
        var dateProblemList = []
        var arr = []
        var problemList = [{}]
        var indexArr = []
        var imgUrlArr = []
        var imgUrl
        var resFileToken = []
        var resImgUrl = []
        var dateFileToken = []
        var c = []
        var a = ''
        var k = []
        var resProblemList = []
        var parblemObj
        var checkResultArr = []
		mui.plusReady(function() {
            initCheckBox()
            var self = plus.webview.currentWebview()
            imgUrl = self.imgUrl
            
            
            dataProblemList = self.dataProblemList
            
            $(".total").html(dateProblemList.length)
            
            var getRecordProblem = null
            getPronlemView()
            // console.log(JSON.stringify(problemList),problemList.length,'problemList')
            // console.log(JSON.stringify(b),b.length,'b')
            
            $('.item-probably-bot').each(function(index){
                        $(this).on('tap', function (e) {
                            // console.log(index)
                            $(this).parent().children($('.item-list')).find($('.dynamic')).toggleClass('text-ellipsis')
                            $('.cut1').eq(index).toggleClass('hidden')
                            $('.cut2').eq(index).toggleClass('hidden')
                            $('.corner1').eq(index).toggleClass('hidden')
                            $('.corner2').eq(index).toggleClass('hidden')
                            $('.pic').eq(index).toggleClass('setHeight')
                        })
            })

            var CheckTypeIndex = null
            var date = new Date();
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            if (month < 10) {
                month = "0" + month;
            }
            if (day < 10) {
                day = "0" + day;
            }
            var nowDate = year + "-" + month + "-" + day;
            // console.log(JSON.stringify(self.dataIndex))
            var stateText = localStorage.getItem('$state') || "{}";
            stateText = JSON.parse(stateText)
            $(".projectName").val(self.dataIndex.projectModel.projectName)
            $(".constructionUnitName").val(self.dataIndex.projectModel.constructionUnitName)
            $(".engineerUnitName").val(self.dataIndex.projectModel.engineerUnitName)

            $(".realname").val(stateText.userInfo.realname)
            $(".inputDepartmenFullname").val(stateText.userInfo.departName)
            $(".mobilePhone").val(stateText.userInfo.personMobilePhone)
            $(".dateSelect-fill").val(nowDate)


            $(".dailyCheckTypeStr").on('tap',function(){
                var picker = new mui.PopPicker();
                picker.setData([
                    {value:'1',text:'日常检查'},
                    {value:'2',text:'抽检'},
                    {value:'3',text:'飞检'},
                    {value:'4',text:'专项检查'},
                ]);
                picker.show(function (selectItems) {
                    $(".dailyCheckTypeStr").val(selectItems[0].text)
                    CheckTypeIndex = selectItems[0].value
                })
            })
            
            var stateText = localStorage.getItem('$state') || "{}";
            stateText = JSON.parse(stateText)
            var checkNum = -1
            $(`input[name='input_hasEslCode']`).each(function(index){
                        $(this).on('click',function(e){
                            if($(this).prop('checked')){
                                checkNum = $(this).val()
                            }else{
                                checkNum = -1
                            }
                        })
                         
                })
                // $(`input[name="input_problem"]`).each(function(index){
                //         $(this).on('click',function(e){
                //             console.log('111')
                //             if($(this).prop('checked')){
                //                 console.log($(this).val())
                //                 // b.push($(this).val())
                //             }else {
                                
                //             }
                //         })
                         
                // })
            $(".btn-sub").on('tap',function(){
                if($(".supervisorUnitName").val() == ''){
                    app.toast('监督名称不能为空')
                    return
                }
                if($(".dailyCheckTypeStr").val() == ''){
                    app.toast('请选择检查类型')
                    return
                }
                if($(".actualCheckTime").val() == ''){
                    app.toast('实际检查日期不能为空')
                    return
                }
                if($(".dailyCheckPersonRealname").val().trim() == ''){
                    app.toast('请输入检查人')
                    return
                }
                if(checkNum == '-1'){
                    app.toast('请选择检查结果')
                    return
                }
                
                $(`input[name="input_problem"]:checked`).each(function(index){
                    k.push($(this).val())
                })
                
                for(var i=0;i<k.length;i++){
                    resProblemList.push(dateProblemList[k[i]])
                    resFileToken.push(dateFileToken[k[i]])
                    resImgUrl.push(imgUrlArr[k[i]])
                }
                console.log(JSON.stringify(k))
                console.log(JSON.stringify(resProblemList))
                console.log(JSON.stringify(resFileToken))
                
                if(resProblemList.length != 0){
                    for(var i=0;i<resProblemList.length;i++){
                        if(resProblemList[i].attachment == '' || resProblemList[i].attachment == null){
                            resProblemList[i].attachment = uuid()
                        }
                        console.log(JSON.stringify(resProblemList[i]))
                        
                        parblemObj = {
                            // recordId:self.dataIndex.guid,
                            // projectName:self.dataProblemList[i].projectModel.projectName,
                            // projectId:dateProblemList[i].projectId,
                            // checkDate:dateProblemList[i].checkDate,
                            // checkResults:[{
                                attachment:resProblemList[i].attachment,
                                checkStandardName:resProblemList[i].checkStandardName,
                                correctRequirement:resProblemList[i].correctRequirement,
                                detailCheckContent:resProblemList[i].detailCheckContent,
                                detailCheckProject:resProblemList[i].detailCheckProject,
                                level:0,
                                standardId:resProblemList[i].standardId,
                                strAttachment:[{
                                                groupId:resProblemList[i].attachment,
                                                fileTokens:resFileToken[i],
                                                fieldName:"attachment",
                                                tableName:"EGY_PLAN_FILE"}],
                                                                // }]

                        }
                        parblemObj.strAttachment = JSON.stringify(parblemObj.strAttachment)

                        checkResultArr.push(parblemObj)
                        // checkResults.push(parblemObj)
                    }
                    // console.log('checkResultArr='+JSON.stringify(checkResultArr))
                    
                }else{
                    var emptyProblem = {
                        attachment:uuid(),
                        level:0,
                        strttachment:[{
                            groupId:uuid(),
                            fileTokens:'',
                            fieldName:"attachment",
                            tableName:"EGY_PLAN_FILE",
                        }]
                    }
                    checkResultArr.push(emptyProblem)
                }
                problemList[0].checkDate = $(".actualCheckTime").val()
                problemList[0].checkResults = checkResultArr
                problemList[0].projectId = self.dataIndex.projectModel.guid
                problemList[0].projectName = self.dataIndex.projectModel.projectName
                problemList[0].recordId = self.dataIndex.guid

                
                
                var type = 'post'
            
                var params = {
                        projectName:$(".projectName").val(),
                        recordId:self.dataIndex.guid,
                        remark:$("#remark").val(),
                        actualCheckResult:parseInt(checkNum),
                        actualCheckTime:$(".actualCheckTime").val(),
                        createRealname:stateText.userInfo.realname,
                        followCheckPerson:$(".followCheckPerson").val(),
                        attachment:'',
                        strAttachment:[{groupId:'',fileTokens:"",fielsdName:"",tableName:"attachment"}],
                        dailyCheckPerson:stateText.userInfo.username,
                        dailyCheckPersonRealname:$(".dailyCheckPersonRealname").val(),
                        dailyCheckType:CheckTypeIndex,
                        dailyName:$(".supervisorUnitName").val(),
                        engineerUnitName:$(".engineerUnitName").val(),
                        problemList:problemList,
                        noticeType: "sms" 
                }
                if(params.attachment == '' || params.attachment == null){
                    params.attachment = uuid()
                }
                if(params.strAttachment[0].groupId == '' || params.strAttachment[0].groupId == null){
                    params.strAttachment[0].groupId = uuid()
                }
                params.strAttachment = JSON.stringify(params.strAttachment)

                
                var url = config.urls.baseUrl + config.actions.addRecord
       
                console.log(JSON.stringify(params))
                
                getProjectPost(url,params,type,function(data){
                    
                    if(data.success){
                        console.log(JSON.stringify(data.result))
                                // app.toast(data.message);
                                // plus.webview.currentWebview().opener().reload();
                                // app.showLoader()
                                // mui.back()
                                
                                var extras = {
                                    resFileToken:resFileToken,
                                    addResult:data.result,
                                    dataProblemList : self.dataProblemList,
                                    imgUrl : self.imgUrl,
                                    projectName:self.projectName,
                                    resProblemList:resProblemList,
                                    resImgUrl:resImgUrl
                                }
                                // console.log(JSON.stringify(extras.resProblemList))
                                // console.log(JSON.stringify(extras.resFileToken))
                                // return
                                app.openPage("./addSuccess.html", {
                                    titleNView: {
                                        titleText: '结果通知',
                                        autoBackButton: true,										
                                    }
                                },extras);
                                $(".supervisorUnitName").val('')
                                $(".dailyCheckTypeStr").val('')
                                $(".actualCheckTime").val('')
                                $(".dailyCheckPersonRealname").val('')
                                $("#remark").val('')
                                $(`input[name='input_hasEslCode']`).each(function(){
                                $(this).prop('checked',false)
                                })
                            }else app.toast("新增失败");
                })
            })
        });
     
    // 时间选择器
    $(".date-select").on('tap',function() {
        var dtPicker = new mui.DtPicker({type:'date'}); 
        dtPicker.show(function (selectItems) { 
            var y = selectItems.y.text;  //获取选择的年
            var m = selectItems.m.text;  //获取选择的月
            var d = selectItems.d.text;  //获取选择的日
            var date = y + "-" + m + "-" + d ;
            //    console.log(date)
               $(".dateSelect").val(date)  
        }) 
    })

    $('.issues-total').on('tap',function () {
        $('.top-bar').toggleClass('hidden')
        $('.bottom-bar').toggleClass('hidden')
        $('.issues-list-item').toggleClass('hidden') 
    })

    var initCheckBox = function() {
			$(".check-item").find(":checkbox").each(function() {
				$(this).click(function() {
					if ($(this).is(':checked')) {
						$(this).parent().siblings().find(":checkbox").each(function() {
							$(this).prop('checked', false)
						});
					}
				});
			});
		}
        // getDatePicker($(".date-sideslip"),$(".actualCheckTime"))
        $(".date-sideslip").on('tap',function(){
            var dtPicker = new mui.DtPicker({type:'date'}); 
            dateProblemList = []
            indexArr = []
            imgUrlArr=[]
            dtPicker.show(function (selectItems) { 
                var y = selectItems.y.text;  //获取选择的年
                var m = selectItems.m.text;  //获取选择的月
                var d = selectItems.d.text;  //获取选择的日
                var date = y + "-" + m + "-" + d ;
                $(".actualCheckTime").val(date)
                console.log(self.dataProblemList.length,'0000000000000')
                for(var i=0;i<self.dataProblemList.length;i++){
                    console.log(self.dataProblemList[i].checkDate)
                    if(self.dataProblemList[i].checkDate == $(".actualCheckTime").val()){
                        dateProblemList.push(dataProblemList[i])
                        indexArr.push(i)
                        imgUrlArr.push(imgUrl[i])
                    }
                    
                }
                
                getPronlemView()
            })
             
        })
    //图片预览
    $(document).on('tap', '.img_src', function() {
		    mui.previewImage();
    });          

    // 受理人选择
	var extras = {}
	$('.dailyCheckPersonRealname').on('tap', function () {
		app.openPage("../../commom/organ.html", {
			titleNView: {
				titleText: '选择人员',
				autoBackButton: true
			}
		}, extras);
 
		var checkPersonBack = function (data) {
			console.log(JSON.stringify(data.detail))
			if (data.detail[0] != undefined) {
				console.log(JSON.stringify(data.detail[0]));
				$(".dailyCheckPersonRealname").val(data.detail[0].realname);
				submitParam.resAuditorName = data.detail[0].realname
				submitParam.resAuditorUsername = data.detail[0].username
			}
			//移除
			window.removeEventListener('returnSelect', checkPersonBack, false);
		}
 
		//移除
		window.removeEventListener('returnSelect', checkPersonBack, false);
		// 赋值
		window.addEventListener('returnSelect', checkPersonBack, false);
	})

    function getPronlemView() {
        $(".issues-list-item").empty()
        $(".total").html(dateProblemList.length)
        console.log('dateProblemList='+JSON.stringify(dateProblemList))
        console.log(dateProblemList.length)
        if(dateProblemList.length != 0){
            for(var i=0;i<dateProblemList.length;i++){
                a=''
                if(dateProblemList[i].detailCheckProject == null){
                    dateProblemList[i].detailCheckProject = '无'
                }
                if(dateProblemList[i].detailCheckContent == null){
                    dateProblemList[i].detailCheckContent = '无'
                }
                if(dateProblemList[i].correctRequirement == null){
                    dateProblemList[i].correctRequirement = '无'
                }
                
                getRecordProblem = `
                <div class="issues-item" >
                                    
                                    <div class="issues-item-probably" >
                                        <div class=" mui-checkbox  " style="padding-bottom:2px;;white-space:nowrap;">
                                            <label></label>
                                            <input class="" name="input_problem" required="true" placeholder="123" value="${i}" type="checkbox" style="position:relative;right:10px;border-color:#0493F3 !important;">
                                        </div>
                                        <div class="item-list ">
                                            <span class="fixed">问题类型:</span>
                                            <span class="dynamic isWrap">${dateProblemList[i].detailCheckProject}</span>
                                        </div>
                                        <div class="item-list ">
                                            <span class="fixed">检查结果:</span>
                                            <span class="dynamic isWrap">${dateProblemList[i].detailCheckContent}</span>
                                        </div>
                                        <div class="item-list ">
                                            <span class="fixed">整改要求:</span>
                                            <span class="dynamic isWrap">${dateProblemList[i].correctRequirement}</span>
                                        </div>
                                        <div class="item-list">
                                            <span class="fixed">相关图片:</span>
                                            <div class="photo${i} pic dynamic clearfix ">  
                                            </div>
                                        </div>
                                    </div>
                                </div>
                `
                // <div class="item-probably-bot">
                //                             <span class="cut cut1 ">详情</span>
                //                             <span class="cut cut2 hidden">收起</span>
                //                             <span  class="mui-icon mui-icon-arrowdown corner corner1"></span>
                //                             <span  class="mui-icon mui-icon-arrowup hidden corner corner2"></span>
                //                         </div>
                $(".issues-list-item").append(getRecordProblem)
                
                if (imgUrlArr[i].result && imgUrlArr[i].result.length && imgUrlArr[i].result[0].uploadFile){
                        for(var j=0;j<imgUrlArr[i].result.length;j++){
                            let path = imgUrlArr[i].result[j].uploadFile.savePath;
                            let url = config.urls.baseUrl + 'sys/common/view/' + path;
                            var html = '<div class="quesList_img">' +
                                    '		<img class="img_src imgCss" data-preview-src="" data-preview-group="1" src="' + url + '" style=""/>' +
                                    '	</div>';
                            $(`.photo${i}`).append(html)
                              
                            a = a + imgUrlArr[i].result[j].fileToken + ','  
                        }

                }else{
                    $(`.photo${i}`).html('<div>无</div>')
                    $(`.photo${i}`).removeClass('setHeight')
                    a = ''
                }
                
                dateFileToken.push(a)
                
            }
               
            }
    }
        
</script>
</html>